<!DOCTYPE html>
<html lang='ru'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Kover Tour Preview</title>
</head>

<body>
    <!-- STYLES -->
    <!-- BLOCK 1: CSS & HEAD -->

    <script src="https://js.stripe.com/v3/"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
    <style>
        /* UNIVERSAL WRAPPER LOGIC */
        .desktop-view {
            display: block;
        }

        .mobile-view {
            display: none;
        }

        @media (max-width: 900px) {
            .desktop-view {
                display: none;
            }

            .mobile-view {
                display: block;
                background: #111;
                min-height: 100vh;
            }

            body {
                background-color: #111 !important;
            }
        }

        @media (min-width: 901px) {
            body {
                background-color: #fff !important;
            }

            /* DESKTOP REVIEW GRID OVERRIDE */
            .m-reviews-section {
                background: #fff !important;
                /* Match desktop white theme */
            }

            .m-reviews-scroll {
                display: flex !important;
                flex-wrap: wrap !important;
                justify-content: center !important;
                overflow: visible !important;
                padding-bottom: 0 !important;
                gap: 30px !important;
                max-width: 1200px !important;
                margin: 0 auto !important;
            }

            .m-review-card {
                width: 300px !important;
                flex: none !important;
                margin-bottom: 30px !important;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1) !important;
                border: 1px solid #eee !important;
            }
        }


        /* --- ШРИФТЫ И ПЕРЕМЕННЫЕ --- */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800;900&display=swap');

        :root {
            --hero-accent: #29B6F6;
            /* Cyan */
            --hero-lime: #BDFF00;
            /* Neon Lime */
            --hero-white: #FFFFFF;
            --hero-dark: #000000;
            --hero-glass: rgba(22, 22, 24, 0.65);
            /* Чуть прозрачнее для зимней атмосферы */
            --hero-glass-border: rgba(255, 255, 255, 0.2);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
        }

        /* --- ГЛАВНЫЙ КОНТЕЙНЕР --- */
        .hero-wrapper {
            position: relative;
            width: 100%;
            min-height: 100vh;
            min-height: 100svh;
            /* Используем локальное изображение, которое мы сгенерировали */
            background: url('https://kovertrip.b-cdn.net/images/hero_bg.webp') no-repeat center center/cover;
            color: var(--hero-white);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            z-index: 1;
        }

        .hero-wrapper * {
            box-sizing: border-box;
        }

        /* Затемнение для читаемости */
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.1) 40%, rgba(0, 0, 0, 0.6) 100%);
            z-index: 2;
            pointer-events: none;
        }

        /* --- ХЕДЕР --- */
        .hero-header {
            position: relative;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
        }

        .hero-logo img {
            height: 40px;
            width: auto;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.4));
            transition: transform 0.3s;
        }

        .hero-logo:hover img {
            transform: scale(1.05);
        }

        .hero-socials {
            display: flex;
            gap: 12px;
        }

        .social-icon {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            background: var(--hero-white);
            transform: translateY(-2px);
        }

        .social-icon svg {
            width: 20px;
            height: 20px;
        }

        .social-icon svg path {
            fill: #fff;
            transition: 0.3s;
        }

        .social-icon:hover svg path {
            fill: #000;
        }

        /* --- КОНТЕНТ --- */
        .hero-content-wrapper {
            position: relative;
            z-index: 5;
            padding: 0 40px 60px 40px;
            display: flex;
            align-items: flex-end;
            justify-content: flex-start;
        }

        .hero-glass-card {
            background: var(--hero-glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--hero-glass-border);
            padding: 40px;
            border-radius: 32px;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s ease 0.2s backwards;
            display: flex;
            flex-direction: column;
            gap: 24px;
            color: #ffffff;
        }

        .hero-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .hero-date-badge {
            background-color: var(--hero-accent);
            color: white;
            font-weight: 800;
            font-size: 13px;
            text-transform: uppercase;
            padding: 8px 16px;
            border-radius: 100px;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(41, 182, 246, 0.4);
        }

        .hero-price-badge {
            background-color: var(--hero-lime);
            color: #000;
            font-weight: 800;
            font-size: 13px;
            text-transform: uppercase;
            padding: 8px 16px;
            border-radius: 100px;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(189, 255, 0, 0.3);
        }

        .hero-tag {
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 7px 14px;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.95);
        }

        .hero-title {
            font-size: 56px;
            font-weight: 900;
            line-height: 0.95;
            text-transform: uppercase;
            margin: 0;
            letter-spacing: -1.5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .hero-title span {
            color: var(--hero-accent);
        }

        .hero-subtitle {
            font-size: 18px;
            font-weight: 500;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            max-width: 90%;
        }

        .hero-btn {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            background-color: var(--hero-accent);
            color: #fff !important;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            text-decoration: none;
            padding: 24px 60px;
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: none;
            cursor: pointer;
            align-self: flex-start;
            box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4);
            margin-top: 10px;
            min-width: 280px;
            text-align: center;
        }

        .hero-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 50px rgba(189, 255, 0, 0.5);
            background-color: #ceff42;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .hero-wrapper {
                height: auto;
                min-height: 100svh;
            }

            .hero-header {
                padding: 20px;
            }

            .hero-content-wrapper {
                padding: 0 16px 40px 16px;
                justify-content: center;
            }

            .hero-glass-card {
                padding: 28px;
                width: 100%;
                border-radius: 28px;
                background: rgba(22, 22, 24, 0.85);
            }

            .hero-title {
                font-size: 36px;
                line-height: 1.0;
            }

            .hero-btn {
                width: 100%;
            }
        }


        /* DESKTOP PROGRAM STYLES */
        .d-program-section {
            padding: 100px 0;
            background: #ffffff;
            /* White background */
            color: #111;
            font-family: 'Montserrat', sans-serif;
        }

        .d-container {
            max-width: 1240px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .d-section-header {
            text-align: center;
            margin-bottom: 70px;
        }

        .d-title {
            font-size: 56px;
            font-weight: 900;
            text-transform: uppercase;
            margin: 0 0 20px 0;
            letter-spacing: -1.5px;
        }

        .d-subtitle {
            font-size: 20px;
            color: #666;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* GRID LAYOUT - ONE LINE if possible, or wrapped gracefully */
        /* HORIZONTAL SCROLL LAYOUT */
        .d-program-grid {
            display: flex;
            flex-wrap: nowrap;
            justify-content: flex-start;
            gap: 24px;
            overflow-x: auto;
            padding: 10px 10px 30px 10px;
            /* Bottom padding for scrollbar/shadows */
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scroll-behavior: smooth;
        }

        .d-program-grid::-webkit-scrollbar {
            height: 8px;
        }

        .d-program-grid::-webkit-scrollbar-track {
            background: #f4f4f4;
            border-radius: 4px;
        }

        .d-program-grid::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 4px;
        }

        .d-program-grid::-webkit-scrollbar-thumb:hover {
            background: #29B6F6;
        }

        .d-card {
            flex: 0 0 340px;
            /* Fixed width for scroll items */
            width: 340px;
            min-width: 340px;
            height: 500px;
            /* Taller card */
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background: #000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .d-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .d-card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s ease;
        }

        .d-card:hover .d-card-img {
            transform: scale(1.05);
        }

        .d-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.6) 60%, transparent);
            color: white;
            height: 60%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .d-card-tags {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            z-index: 2;
        }

        .d-tag {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            color: rgba(255, 255, 255, 0.95);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            padding: 5px 10px;
            border-radius: 6px;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .d-tag.lime {
            background: #BDFF00;
            color: black;
            border: none;
        }

        .d-card-title {
            font-size: 24px;
            font-weight: 800;
            line-height: 1.05;
            margin: 0 0 8px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .d-card-desc {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            margin: 0 0 16px 0;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .d-card-btn {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            transition: 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .d-card:hover .d-card-btn {
            background: #29B6F6;
            border-color: #29B6F6;
            color: white;
        }

        /* DESKTOP MODAL */
        .d-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            /* Nearly solid black for immersion */
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .d-modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .d-modal-container {
            width: 1200px;
            height: 85vh;
            background: #111;
            border-radius: 30px;
            display: flex;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 100px rgba(41, 182, 246, 0.1);
            transform: scale(0.95);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            border: 1px solid #333;
        }

        .d-modal-overlay.active .d-modal-container {
            transform: scale(1);
        }

        /* Modal Layout: Left Gallery (60%), Right Content (40%) */
        .d-modal-left {
            width: 65%;
            height: 100%;
            position: relative;
            background: #000;
        }

        .d-gallery-main {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s;
            position: absolute;
            top: 0;
            left: 0;
        }

        .d-gallery-main.active {
            opacity: 1;
        }

        .d-gallery-thumbs {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            z-index: 10;
        }

        .d-thumb {
            width: 60px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            opacity: 0.7;
            transition: 0.2s;
        }

        .d-thumb:hover,
        .d-thumb.active {
            border-color: #29B6F6;
            opacity: 1;
            transform: scale(1.1);
        }

        .d-modal-right {
            width: 35%;
            padding: 50px 40px;
            overflow-y: auto;
            color: #eee;
            display: flex;
            flex-direction: column;
        }

        .d-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 28px;
            color: white;
            transition: 0.2s;
            z-index: 50;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .d-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        /* Content Styles inside Modal */
        .d-modal-title {
            font-size: 38px;
            font-weight: 800;
            margin: 20px 0 10px;
            color: white;
            line-height: 1;
        }

        .d-modal-subtitle {
            font-size: 15px;
            color: #888;
            margin-bottom: 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .d-modal-text {
            font-size: 16px;
            line-height: 1.7;
            color: #ccc;
            margin-bottom: 24px;
        }

        .d-modal-h {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin: 30px 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .d-modal-quote {
            background: #1A1A1A;
            border-left: 4px solid #29B6F6;
            padding: 20px;
            font-style: italic;
            color: #bbb;
            margin: 20px 0;
            border-radius: 0 12px 12px 0;
        }

        /* Booking/Rating Badge */
        .d-rating-badge {
            display: inline-flex;
            align-items: center;
            background: #222;
            padding: 8px 16px;
            border-radius: 12px;
            gap: 10px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .d-score {
            background: #003580;
            color: white;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .d-score.google {
            background: #4285F4;
        }


        /* Desktop Timeline Styles */
        .d-time-section {
            background-color: #F8F9FA;
            padding: 100px 20px;
            font-family: 'Montserrat', sans-serif;
        }

        .d-time-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .d-time-title {
            font-size: 42px;
            font-weight: 800;
            margin: 0;
            color: #111;
            text-transform: uppercase;
        }

        .d-days-grid {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            position: relative;
        }

        /* Vertical Divider */
        .d-days-grid::after {
            content: '';
            position: absolute;
            top: 50px;
            bottom: 0;
            left: 50%;
            width: 1px;
            background: #E0E0E0;
            transform: translateX(-50%);
        }

        .d-day-col {
            position: relative;
            z-index: 2;
        }

        .d-day-header {
            font-size: 24px;
            font-weight: 800;
            color: #29B6F6;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .d-t-item {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: flex-start;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            transition: transform 0.2s;
        }

        .d-t-item:hover {
            transform: translateX(5px);
        }

        .d-t-time {
            font-weight: 800;
            font-size: 16px;
            color: #29B6F6;
            min-width: 50px;
            padding-top: 2px;
        }

        .d-t-desc {
            font-size: 15px;
            color: #555;
            line-height: 1.5;
        }

        .d-t-desc strong {
            color: #000;
            display: block;
            margin-bottom: 4px;
            font-size: 16px;
        }

        @media (max-width: 900px) {
            .d-days-grid {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .d-days-grid::after {
                display: none;
            }
        }


        /* DESKTOP REVIEWS STYLES */
        .d-reviews-section {
            --kover-accent: #18B7EA;
            --kover-dark: #1A1A1A;
            --kover-gray: #F4F5F7;
            --kover-white: #FFFFFF;

            background-color: #fff;
            padding: 100px 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
        }

        .d-reviews-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .d-reviews-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .d-reviews-title {
            font-size: 42px;
            font-weight: 800;
            color: var(--kover-dark);
            margin: 0 0 16px 0;
        }

        .d-reviews-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #FFF4E5;
            color: #B34010;
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 16px;
        }

        /* GRID LAYOUT */
        .d-reviews-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        /* CARDS */
        .d-review-card {
            height: 500px;
            /* Taller for desktop */
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            background: var(--kover-white);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .d-review-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        /* Video Card */
        .d-card-video {
            background: black;
            cursor: pointer;
        }

        .d-rv-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .d-rv-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            pointer-events: none;
        }

        .d-rv-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: var(--kover-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(24, 183, 234, 0.5);
            transition: 0.3s;
            z-index: 10;
            pointer-events: none;
        }

        .d-card-video.is-playing .d-rv-play-btn,
        .d-card-video.is-playing .d-rv-overlay,
        .d-card-video.is-playing .d-badg-bottom {
            opacity: 0;
        }

        .d-play-icon {
            width: 24px;
            height: 24px;
            fill: white;
            margin-left: 4px;
        }

        .d-badg-bottom {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            z-index: 5;
        }

        /* Hybrid Card */
        .d-card-hybrid {
            display: flex;
            flex-direction: column;
            background: transparent;
            box-shadow: none;
            gap: 20px;
        }

        .d-hybrid-video {
            flex: 1;
            border-radius: 24px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .d-hybrid-video video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .d-hybrid-stat {
            height: 140px;
            background: white;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .d-stat-num {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(90deg, #29B6F6 0%, #A08C85 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 5px;
        }

        .d-stat-text {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .d-cta-wrap {
            text-align: center;
            margin-top: 60px;
        }

        .d-btn-primary {
            background: #29B6F6;
            color: white !important;
            padding: 24px 60px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            text-decoration: none;
            box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4);
            transition: 0.2s;
            display: inline-block;
        }

        .d-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(24, 183, 234, 0.4);
        }


        .d-org-section {
            padding: 100px 0;
            background: #111;
            color: white;
            font-family: 'Montserrat', sans-serif;
        }

        .d-org-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            /* Included takes more space */
            gap: 60px;
        }

        .d-org-h2 {
            grid-column: 1 / -1;
            text-align: center;
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 60px;
        }

        .d-info-card {
            background: #1A1A1A;
            border-radius: 24px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .d-info-card.accent {
            border: 1px solid rgba(41, 182, 246, 0.3);
            background: linear-gradient(145deg, #1A1A1A, #151515);
        }

        .d-info-h {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .d-price-large {
            font-size: 28px;
            color: #29B6F6;
            font-weight: 800;
        }

        .d-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .d-list li {
            margin-bottom: 16px;
            font-size: 16px;
            color: #ddd;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .d-list li.check::before {
            content: '✔';
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: rgba(41, 182, 246, 0.1);
            color: #29B6F6;
            border-radius: 50%;
            font-size: 14px;
        }

        .d-clothing {
            grid-column: 1 / -1;
            background: #222;
            padding: 30px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .d-clothing-icon {
            font-size: 40px;
        }

        .d-clothing-text {
            font-size: 16px;
            color: #ccc;
            line-height: 1.5;
        }


        .d-how-section {
            background-color: #111;
            /* Dark background to match end of page flow */
            padding: 100px 0;
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            border-top: 1px solid #222;
        }

        .d-how-container {
            max-width: 1240px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .d-how-header {
            text-align: center;
            margin-bottom: 70px;
        }

        .d-how-title {
            font-size: 48px;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        .d-how-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 50px;
        }

        .d-how-item {
            background: #1a1a1a;
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #333;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .d-how-item:hover {
            transform: translateY(-10px);
            border-color: #29B6F6;
        }

        /* Steps Highlight colors */
        .d-how-item:nth-child(2):hover {
            border-color: #BDFF00;
        }

        .d-how-icon-box {
            width: 64px;
            height: 64px;
            background: rgba(41, 182, 246, 0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            color: #29B6F6;
        }

        .d-how-item:nth-child(2) .d-how-icon-box {
            background: rgba(189, 255, 0, 0.1);
            color: #BDFF00;
        }

        .d-how-item:nth-child(3) .d-how-icon-box {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .d-how-icon-box svg {
            width: 32px;
            height: 32px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .d-how-h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            color: white;
        }

        .d-how-p {
            font-size: 16px;
            line-height: 1.6;
            color: #aaa;
        }


        /* Desktop Team Block */
        .d-team-section {
            background-color: #111;
            padding: 80px 0 0;
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            overflow: hidden;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .d-team-container {
            max-width: 1240px;
            margin: 0 auto;
            padding: 0 40px;
            text-align: center;
        }

        .d-team-title {
            font-size: 56px;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 30px;
        }

        .d-team-subtitle {
            font-size: 18px;
            color: #aaa;
            max-width: 800px;
            margin: 0 auto 50px;
            line-height: 1.6;
        }

        .d-team-tags {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 60px;
        }

        .d-team-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 14px;
            color: #ddd;
        }

        .d-team-tag.accent {
            background: #BDFF00;
            color: black;
        }

        /* DESKTOP MARQUEE */
        .d-marquee-wrap {
            width: 100%;
            overflow: hidden;
            padding: 40px 0 80px;
            position: relative;
            /* Fade sides */
            mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
        }

        .d-marquee-track {
            display: flex;
            gap: 30px;
            width: max-content;
            animation: dScroll 40s linear infinite;
            /* Slower on desktop */
        }

        .d-team-card {
            width: 300px;
            height: 400px;
            flex-shrink: 0;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            border: 4px solid #fff;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .d-team-card:nth-child(odd) {
            transform: rotate(-3deg);
            margin-top: 20px;
            border-color: #29B6F6;
        }

        .d-team-card:nth-child(even) {
            transform: rotate(3deg);
            margin-bottom: 20px;
            border-color: #BDFF00;
        }

        .d-team-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* grayscale filter optional, maybe too sad */
        }

        @keyframes dScroll {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }


        .d-cta-section {
            background-color: #111;
            padding: 100px 0;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .d-cta-title {
            font-size: 56px;
            font-weight: 900;
            margin-bottom: 24px;
            text-transform: uppercase;
            line-height: 1.1;
        }

        .d-cta-sub {
            font-size: 20px;
            color: #ccc;
            margin-bottom: 50px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .d-cta-btn {
            display: inline-block;
            background: #29B6F6;
            color: #ffffff !important;
            font-weight: 800;
            text-transform: uppercase;
            padding: 24px 60px;
            border-radius: 20px;
            font-size: 20px;
            text-decoration: none;
            box-shadow: 0 20px 50px rgba(41, 182, 246, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            min-width: 280px;
        }

        .d-cta-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(41, 182, 246, 0.5);
        }

        .d-cta-btn:active {
            transform: scale(0.95);
        }


        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap');

        :root {
            --brand-cyan: #29B6F6;
            --brand-lime: #BDFF00;
            --brand-dark: #111111;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            background-color: var(--brand-dark);
            color: white;
            overflow-x: hidden;
            width: 100%;
        }

        /* Full Screen Hero optimized for Mobile */
        .m-hero {
            position: relative;
            height: 100svh;
            /* Perfect mobile height */
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: url('https://kovertrip.b-cdn.net/images/hero_bg.webp') no-repeat center center/cover;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            overflow: hidden;
            /* Cut off any potential overflow */
        }

        /* Better scrim gradient for readability */
        .m-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom,
                    rgba(0, 0, 0, 0.3) 0%,
                    rgba(0, 0, 0, 0) 30%,
                    rgba(0, 0, 0, 0.4) 60%,
                    rgba(0, 0, 0, 0.9) 100%);
            z-index: 1;
        }

        .m-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .m-logo img {
            height: 32px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .m-hero-content {
            position: relative;
            z-index: 5;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Compact Badges Row */
        .m-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 4px;
        }

        .m-badge {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .m-badge.accent {
            background: var(--brand-cyan);
            border-color: var(--brand-cyan);
            color: white;
            box-shadow: 0 4px 12px rgba(41, 182, 246, 0.4);
        }

        /* Typography optimized for small screens */
        .m-title {
            font-size: 36px;
            line-height: 0.95;
            font-weight: 800;
            text-transform: uppercase;
            margin: 0;
            letter-spacing: -1px;
        }

        .m-title span {
            color: var(--brand-cyan);
        }

        .m-subtitle {
            font-size: 15px;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            max-width: 90%;
        }

        /* Sticky-feeling CTA */
        .m-cta-btn {
            background: var(--brand-cyan);
            color: white !important;
            border: none;
            width: auto;
            max-width: 92%;
            margin-left: auto;
            margin-right: auto;
            display: block;
            padding: 16px 24px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 800;
            text-transform: uppercase;
            margin-top: 16px;
            box-shadow: 0 10px 30px rgba(41, 182, 246, 0.4);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.2s;
        }

        .m-cta-btn:active {
            transform: scale(0.98);
        }


        /* Mobile Program - Premium Image Cards (Story Style) */
        .m-program-section {
            background: #111;
            padding: 40px 0;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }

        .m-section-header {
            padding: 0 20px 24px;
        }

        .m-h2 {
            font-size: 28px;
            font-weight: 800;
            color: #fff;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .m-sub {
            color: #888;
            font-size: 14px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Highlight icon */
        .m-sub-icon {
            color: #29B6F6;
            font-size: 16px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.5;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }

            100% {
                opacity: 0.5;
                transform: scale(1);
            }
        }

        .m-prog-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 0 20px 40px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .m-prog-scroll::-webkit-scrollbar {
            display: none;
        }

        .m-story-card {
            flex: 0 0 280px;
            height: 420px;
            border-radius: 20px;
            scroll-snap-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: #222;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .m-story-card:active {
            transform: scale(0.98);
        }

        .m-story-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .m-story-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.6) 60%, transparent 100%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
        }

        .m-story-tags {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            z-index: 2;
        }

        .m-story-tag {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            color: rgba(255, 255, 255, 0.9);
            font-size: 9px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            border: 1px solid rgba(255, 255, 255, 0.15);
            letter-spacing: 0.5px;
        }



        .m-photo-count {
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 10;
        }



        .m-story-tag.orange {
            background: #FF6B35;
            border: none;
        }

        .m-story-title {
            font-size: 24px;
            font-weight: 800;
            color: white;
            margin: 0 0 6px 0;
            line-height: 1.1;
        }

        /* Improved Affordance Button */
        .m-story-btn {
            margin-top: 12px;
            background: #29B6F6;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            width: fit-content;
            box-shadow: 0 4px 12px rgba(41, 182, 246, 0.3);
        }

        .m-story-desc {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 4px;
        }

        /* POPUP STYLES */
        .m-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            z-index: 1000;
            /* Higher than header */
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            display: flex;
            align-items: flex-end;
            /* Sheet style */
        }

        .m-popup-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Sheet container */
        .m-popup-sheet {
            background: #1A1A1A;
            width: 100%;
            height: 92vh;
            /* Takes up most of screen */
            border-radius: 24px 24px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
        }

        .m-popup-overlay.active .m-popup-sheet {
            transform: translateY(0);
        }

        /* Drag Handle */
        .m-sheet-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            z-index: 10;
            display: flex;
            justify-content: center;
            padding-top: 8px;
        }

        .m-sheet-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 100px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* GALLARY SWIPER */
        .m-gallery-container {
            width: 100%;
            height: 350px;
            /* Big image area */
            position: relative;
            flex-shrink: 0;
            background: #000;
        }

        .m-gallery-scroll {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            height: 100%;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .m-gallery-scroll::-webkit-scrollbar {
            display: none;
        }

        .m-gallery-img {
            flex: 0 0 100%;
            width: 100%;
            height: 100%;
            object-fit: cover;
            scroll-snap-align: center;
        }

        .m-gallery-dots {
            position: absolute;
            bottom: 12px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 6px;
            pointer-events: none;
        }

        .m-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transition: all 0.2s;
        }

        .m-dot.active {
            background: #fff;
            transform: scale(1.2);
        }

        .m-popup-content {
            padding: 24px 24px 100px;
            /* Extra padding for bottom scroll */
            margin-top: 0;
            position: relative;
            z-index: 5;
            background: #1A1A1A;
            /* To cover bottom of image if rounded */
            border-radius: 24px 24px 0 0;
            min-height: 500px;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
        }



        .m-popup-title {
            font-size: 28px;
            font-weight: 800;
            color: white;
            margin: 30px 0 8px 0;
            line-height: 1.05;
        }

        .m-popup-subtitle {
            font-size: 14px;
            color: #888;
            margin-bottom: 16px;
            font-weight: 500;
        }

        /* -- Mini Article Styles -- */
        .m-article-text {
            font-size: 16px;
            line-height: 1.6;
            color: #d0d0d0;
            margin-bottom: 24px;
        }

        .m-article-h {
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin: 24px 0 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .m-article-tag {
            background: #333;
            color: #ccc;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        /* Booking / Reviews */
        .m-booking-block {
            background: #252525;
            border-radius: 16px;
            padding: 16px;
            margin: 20px 0;
            border: 1px solid #333;
        }

        .m-rating-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .m-star {
            color: #FFD700;
        }

        .m-rating-val {
            background: #003580;
            /* Booking blue style */
            color: white;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 6px 6px 6px 0;
            font-size: 14px;
        }

        .m-quote-card {
            background: #222;
            border-left: 4px solid #29B6F6;
            padding: 16px;
            font-style: italic;
            color: #bbb;
            margin: 16px 0;
            border-radius: 0 12px 12px 0;
            font-size: 15px;
        }

        .m-g-review {
            display: flex;
            gap: 12px;
            background: #222;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .m-g-avatar {
            width: 40px;
            height: 40px;
            background: #666;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .m-g-name {
            font-weight: 700;
            color: white;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .m-g-stars {
            color: #FFD700;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .m-g-text {
            font-size: 13px;
            color: #aaa;
            line-height: 1.4;
        }

        .m-popup-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            background: #29B6F6;
            color: white;
            font-weight: 700;
            text-decoration: none;
            padding: 14px;
            border-radius: 12px;
            margin-top: 10px;
            text-transform: uppercase;
            font-size: 14px;
        }

        .m-popup-link.booking {
            background: #003580;
            /* Booking.com color */
        }

        .m-popup-link.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Close Button Overlay */
        .m-close-round {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            z-index: 20;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .m-sticky-close {
            background: #333;
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            margin-top: 30px;
        }

        /* Video Player Styles */
        .m-video-responsive {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #000;
            margin-top: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .m-video-responsive video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
            object-fit: cover;
        }

        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            pointer-events: none;
        }

        .play-icon {
            width: 50px;
            height: 50px;
            background: #BDFF00;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .m-video-responsive.playing .play-overlay {
            opacity: 0;
            transform: scale(1.1);
        }

        /* === PREMIUM VIDEO CARD STYLE (From Reviews.html) === */
        .m-card-video {
            width: 100%;
            max-width: 320px;
            /* Limit width like a card */
            height: 480px;
            /* Fixed height ~ Vertical 9:16-ish */
            margin: 0 auto 24px;
            /* Center it */
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            background: #000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .m-video-cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        .m-video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 3;
            display: flex;
            align-items: flex-end;
            padding: 20px;
        }

        .m-video-caption {
            color: white;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .m-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(12px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 4;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .m-card-video.playing .m-play-btn,
        .m-card-video.playing .m-video-overlay,
        .m-card-video.playing .m-video-poster {
            opacity: 0;
        }

        .m-play-icon {
            width: 24px;
            height: 24px;
            fill: white;
            margin-left: 4px;
            /* Optical centering */
        }


        /* --- 1. БАЗОВЫЕ СТИЛИ (SCOPED) --- */
        .reviews-section-v3 {
            --kover-accent: #18B7EA;
            --kover-dark: #1A1A1A;
            --kover-gray: #F4F5F7;
            --kover-white: #FFFFFF;
            --text-main: #2C2C2C;
            --text-secondary: #666666;

            --card-radius: 20px;
            --container-padding: 20px;
            --gap: 16px;
            --card-height: 415px;
            --card-width: 280px;

            font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
            padding: 40px 0;
            overflow: hidden;
            background-color: var(--kover-gray);
            position: relative;
            color: var(--text-main);
        }

        .reviews-section-v3 *,
        .reviews-section-v3 *::before,
        .reviews-section-v3 *::after {
            box-sizing: border-box;
        }

        .reviews-section-v3 .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--container-padding);
            position: relative;
        }

        .reviews-section-v3 .reviews-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .reviews-section-v3 .reviews-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--kover-dark);
            margin: 0 0 8px 0;
            line-height: 1.2;
        }

        .reviews-section-v3 .rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #FFF4E5;
            color: #B34010;
            padding: 6px 12px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .reviews-section-v3 .rating-star {
            fill: #FFC107;
            width: 16px;
            height: 16px;
        }

        .reviews-section-v3 .reviews-track-wrapper {
            margin-left: max(0px, calc((100% - 1200px) / 2));
            padding: 0 var(--container-padding) 30px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            display: flex;
            gap: var(--gap);
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-behavior: smooth;
        }

        .reviews-section-v3 .reviews-track-wrapper::-webkit-scrollbar {
            display: none;
        }

        /* CARDS */
        .reviews-section-v3 .review-card,
        .reviews-section-v3 .review-column,
        .reviews-section-v3 .review-card--hybrid-split,
        .reviews-section-v3 .review-card--video,
        .reviews-section-v3 .review-card--apple,
        .reviews-section-v3 .review-card--scrollable {
            flex: 0 0 var(--card-width);
            width: var(--card-width);
            height: var(--card-height);
            scroll-snap-align: center;
            border-radius: var(--card-radius);
            position: relative;
            overflow: hidden;
            background: var(--kover-white);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            transition: transform 0.3s ease;
        }

        /* === TYPE 1: VIDEO === */
        .reviews-section-v3 .review-card--video {
            background: #000;
            cursor: pointer;
        }

        .reviews-section-v3 .review-video,
        .reviews-section-v3 .video-poster-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        .reviews-section-v3 .video-poster-img {
            z-index: 1;
        }

        .reviews-section-v3 .review-video {
            z-index: 2;
        }

        .reviews-section-v3 .video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 3;
        }

        .reviews-section-v3 .video-badge-bottom {
            position: absolute;
            top: auto;
            bottom: 12px;
            left: 12px;
            right: auto;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #fff;
            z-index: 5;
            border: 1px solid rgba(255, 255, 255, 0.15);
            pointer-events: none;
        }

        .reviews-section-v3 .rv-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 56px;
            height: 56px;
            background: var(--kover-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 4;
            pointer-events: none;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(24, 183, 234, 0.4);
        }

        .reviews-section-v3 .rv-play-icon {
            width: 20px;
            height: 20px;
            fill: white;
            margin-left: 3px;
        }

        .reviews-section-v3 .video-info {
            position: absolute;
            bottom: 16px;
            left: 16px;
            z-index: 5;
            color: white;
            pointer-events: none;
        }

        .reviews-section-v3 .video-info a {
            pointer-events: auto;
        }

        .reviews-section-v3 .video-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin-top: 0;
        }

        .reviews-section-v3 .review-card--video.is-playing .rv-play-btn,
        .reviews-section-v3 .review-card--video.is-playing .video-overlay,
        .reviews-section-v3 .review-card--video.is-playing .video-poster-img {
            opacity: 0;
            pointer-events: none;
        }

        /* === TYPE 2: HYBRID SPLIT === */
        .reviews-section-v3 .review-card--hybrid-split {
            display: flex;
            flex-direction: column;
            background: transparent;
            box-shadow: none;
            gap: 12px;
        }

        .reviews-section-v3 .hybrid-video-section {
            width: 100%;
            flex: 1;
            background: #000;
            position: relative;
            border-radius: var(--card-radius);
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            cursor: pointer;
        }

        .reviews-section-v3 .hybrid-overlay-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 12px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), transparent);
            z-index: 5;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
        }

        .reviews-section-v3 .hybrid-author-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .reviews-section-v3 .hybrid-tour-name {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .reviews-section-v3 .hybrid-video-wrap {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .reviews-section-v3 .hybrid-video-wrap video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .reviews-section-v3 .hybrid-video-wrap .rv-play-btn {
            width: 44px;
            height: 44px;
            z-index: 4;
        }

        .reviews-section-v3 .hybrid-video-wrap.is-playing .rv-play-btn {
            opacity: 0;
        }

        .reviews-section-v3 .hybrid-stats-section {
            flex: 1;
            padding: 16px;
            background: var(--kover-white);
            border-radius: var(--card-radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .reviews-section-v3 .hybrid-stat-number {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--kover-accent), #FF8F6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 8px;
            letter-spacing: -2px;
        }

        .reviews-section-v3 .hybrid-stat-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.3;
            font-weight: 500;
            text-wrap: balance;
        }

        /* === TYPE 3: APPLE AUDIO === */
        .reviews-section-v3 .review-card--apple {
            background: var(--kover-white);
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .reviews-section-v3 .apple-image-section {
            height: 240px;
            width: 100%;
            position: relative;
            overflow: hidden;
            border-radius: var(--card-radius) var(--card-radius) 0 0;
            background-color: #f0f0f0;
        }

        .reviews-section-v3 .apple-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .reviews-section-v3 .apple-content-section {
            flex: 1;
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 12px;
            position: relative;
        }

        .reviews-section-v3 .apple-content-section::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 24px;
            width: 12px;
            height: 12px;
            background: var(--kover-white);
            transform: rotate(45deg);
            z-index: 2;
        }

        .reviews-section-v3 .apple-name {
            font-weight: 700;
            font-size: 1rem;
            color: #000;
        }

        .reviews-section-v3 .apple-tour {
            font-size: 0.75rem;
            color: #888;
            margin-top: 2px;
        }

        .reviews-section-v3 .apple-player-row {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #F4F5F7;
            padding: 10px;
            border-radius: 12px;
        }

        .reviews-section-v3 .apple-play-btn {
            width: 36px;
            height: 36px;
            background: var(--kover-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(255, 107, 53, 0.3);
        }

        .reviews-section-v3 .apple-icon {
            width: 14px;
            height: 14px;
            fill: #fff;
            margin-left: 2px;
        }

        .reviews-section-v3 .apple-pause {
            display: none;
            width: 12px;
            height: 12px;
            fill: #fff;
        }

        .reviews-section-v3 .review-card--apple.is-playing .apple-icon {
            display: none;
        }

        .reviews-section-v3 .review-card--apple.is-playing .apple-pause {
            display: block;
        }

        .reviews-section-v3 .apple-waveform-stack {
            flex-grow: 1;
            height: 20px;
            position: relative;
        }

        .reviews-section-v3 .apple-layer {
            width: 100%;
            height: 100%;
            display: flex;
            gap: 2px;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
        }

        .reviews-section-v3 .apple-bar {
            flex: 1;
            border-radius: 2px;
        }

        .reviews-section-v3 .apple-layer-gray .apple-bar {
            background: #D1D5DB;
        }

        .reviews-section-v3 .apple-layer-black .apple-bar {
            background: var(--kover-accent);
        }

        .reviews-section-v3 .apple-layer-black {
            clip-path: inset(0 100% 0 0);
            transition: clip-path 0.1s linear;
        }

        .reviews-section-v3 .apple-bar:nth-child(odd) {
            height: 40%;
        }

        .reviews-section-v3 .apple-bar:nth-child(2n) {
            height: 70%;
        }

        .reviews-section-v3 .apple-time {
            font-size: 0.7rem;
            color: #999;
            min-width: 28px;
            text-align: right;
        }

        /* === TYPE 4: SCROLLABLE LIST === */
        .reviews-section-v3 .review-card--scrollable {
            display: flex;
            flex-direction: column;
        }

        .reviews-section-v3 .review-card--scrollable::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(to bottom, transparent, var(--kover-white));
            pointer-events: none;
        }

        .reviews-section-v3 .scroll-track {
            overflow-y: auto;
            height: 100%;
            padding: 20px 16px 80px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reviews-section-v3 .review-item-scroll {
            background: #F9FAFB;
            padding: 14px;
            border-radius: 16px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .reviews-section-v3 .review-text-body {
            font-size: 0.8rem;
            line-height: 1.4;
            color: var(--text-main);
        }

        .reviews-section-v3 .mini-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 2px;
        }

        .reviews-section-v3 .mini-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
        }

        .reviews-section-v3 .mini-name {
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--kover-dark);
        }

        .reviews-section-v3 .sc-insta-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #fff;
            border: 1px solid #eaeaea;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            color: #666;
            text-decoration: none;
            margin-left: auto;
        }

        .reviews-section-v3 .insta-icon-mini {
            width: 11px;
            height: 11px;
            fill: #E1306C;
        }

        .reviews-section-v3 .review-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
            padding-top: 8px;
            border-top: 1px solid rgba(0, 0, 0, 0.03);
        }

        .reviews-section-v3 .sc-rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--kover-dark);
            background: #FFF4E5;
            padding: 2px 8px;
            border-radius: 6px;
        }

        .reviews-section-v3 .sc-rating-badge svg {
            width: 12px;
            height: 12px;
            fill: #FFC107;
            margin-bottom: 1px;
        }

        /* CTA */
        .reviews-section-v3 .cta-container {
            text-align: center;
            margin-top: 20px;
        }

        .reviews-section-v3 .btn-primary {
            display: inline-block;
            background-color: #29B6F6;
            color: white !important;
            font-weight: 800;
            padding: 16px 32px;
            border-radius: 20px;
            font-size: 16px;
            text-decoration: none;
            box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4);
            text-transform: uppercase;
        }

        @media (max-width: 480px) {
            .reviews-section-v3 {
                --card-width: 80vw;
            }

            .reviews-section-v3 .reviews-track-wrapper {
                padding-left: 20px;
                padding-right: 20px;
                margin-left: 0;
            }
        }




        .m-time-section {
            background-color: #111;
            /* Mobile Dark Theme */
            padding: 40px 20px 40px;
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .m-time-header {
            margin-bottom: 32px;
        }

        .m-time-title {
            font-size: 28px;
            font-weight: 800;
            margin: 0 0 8px 0;
            color: #fff;
        }

        .m-time-sub {
            font-size: 14px;
            color: #888;
        }

        .m-day-block {
            margin-bottom: 40px;
        }

        .m-day-header {
            font-size: 20px;
            font-weight: 700;
            color: #29B6F6;
            /* Cyan Accent */
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .m-day-icon {
            font-size: 24px;
        }

        .m-t-item {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            position: relative;
        }

        /* Vertical Line */
        .m-t-item::before {
            content: '';
            position: absolute;
            left: 5px;
            /* Aligned with dot center */
            top: 24px;
            bottom: -24px;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }

        .m-t-item:last-child::before {
            display: none;
        }

        .m-t-time {
            font-weight: 700;
            font-size: 14px;
            color: #29B6F6;
            min-width: 45px;
            padding-top: 2px;
            position: relative;
            z-index: 2;
        }

        /* Dot */
        .m-t-time::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: #29B6F6;
            border-radius: 50%;
            left: -19px;
            /* Adjust based on gap */
            top: 6px;
            box-shadow: 0 0 10px rgba(41, 182, 246, 0.4);
        }

        /* Adjust for no graphic line if simple layout preferred, 
       but let's trying simple left alignment first */
        .m-t-item {
            gap: 16px;
        }

        .m-t-time::after {
            display: none;
        }

        .m-t-item::before {
            display: none;
        }


        .m-t-desc {
            font-size: 14px;
            color: #ccc;
            line-height: 1.5;
        }

        .m-t-desc strong {
            color: #fff;
            display: block;
            margin-bottom: 2px;
            font-size: 15px;
        }


        .m-org-section {
            background: #111;
            padding: 40px 20px 60px;
            /* Extra bottom padding for floating btn */
            color: #fff;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .m-org-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .m-org-title {
            font-size: 28px;
            font-weight: 800;
            margin: 0;
            letter-spacing: -0.5px;
        }

        /* Cards */
        .m-info-card {
            background: #222;
            padding: 24px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .m-info-card.accent {
            background: linear-gradient(135deg, #222 0%, #2a2a2a 100%);
            border: 1px solid #29B6F6;
            position: relative;
            overflow: hidden;
        }

        /* Subtle glow for accent card */
        .m-info-card.accent::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(41, 182, 246, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        /* Thrown Emojis */
        .clothing-icons {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 70px;
            height: 60px;
            pointer-events: none;
        }

        .emoji-icon {
            position: absolute;
            font-size: 38px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.5));
        }

        .e-coat {
            right: 25px;
            top: 0;
            transform: rotate(-15deg);
            z-index: 1;
        }

        .e-hat {
            right: 0;
            bottom: 0;
            transform: rotate(20deg);
            z-index: 2;
        }


        .m-info-h {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .m-price-tag {
            background: #29B6F6;
            color: white;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 800;
            box-shadow: 0 4px 10px rgba(41, 182, 246, 0.3);
        }

        .m-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .m-list li {
            margin-bottom: 14px;
            padding-left: 28px;
            position: relative;
            font-size: 15px;
            color: #ccc;
            line-height: 1.5;
        }

        .m-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 8px;
            width: 6px;
            height: 6px;
            background: #444;
            border-radius: 50%;
        }

        .m-list li.check::before {
            background: transparent;
            content: '✓';
            color: #29B6F6;
            font-weight: 900;
            font-size: 16px;
            top: -1px;
            left: -2px;
        }

        .m-info-text {
            font-size: 15px;
            line-height: 1.6;
            color: #bbb;
        }

        /* Floating Start Button */
        .m-float-cta {
            position: fixed;
            bottom: 24px;
            left: 20px;
            right: 20px;
            background: #29B6F6;
            color: white;
            padding: 16px;
            border-radius: 20px;
            border: none;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 16px;
            box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4);
            z-index: 100;
            text-align: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: transform 0.2s, opacity 0.3s;
            opacity: 0;
            pointer-events: none;
        }

        .m-float-cta.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .m-float-cta:active {
            transform: scale(0.96);
        }

        .m-float-spacer {
            height: 40px;
        }


        /* Mobile How It Works Section - Vertical Compact Redesign */
        .m-how-section {
            background-color: #111;
            padding: 40px 20px 60px;
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .m-how-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 32px;
            color: #fff;
            /* text-align: center; Optional */
        }

        .m-how-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .m-how-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .m-how-icon-box {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: rgba(41, 182, 246, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #29B6F6;
            border: 1px solid rgba(41, 182, 246, 0.2);
        }

        .m-how-icon-box svg {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .m-how-content {
            padding-top: 2px;
        }

        .m-how-content h3 {
            font-size: 16px;
            font-weight: 700;
            color: #fff;
            margin: 0 0 6px 0;
        }

        .m-how-content p {
            font-size: 14px;
            color: #aaa;
            margin: 0;
            line-height: 1.5;
        }


        /* Mobile Team Block */
        .m-team-section {
            background-color: #111;
            padding: 40px 20px 0;
            /* Important: 0 bottom padding for seamless Marquee */
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .m-team-header {
            margin-bottom: 24px;
            position: relative;
            z-index: 2;
        }

        .m-team-title {
            font-size: 28px;
            font-weight: 800;
            margin: 0 0 16px 0;
            color: #fff;
            line-height: 1.1;
        }

        .m-tags-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .m-tag {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            padding: 6px 10px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }

        .m-tag.accent {
            background: #BDFF00;
            color: #000;
        }

        .m-team-desc {
            font-size: 15px;
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .m-highlight {
            color: #fff;
            font-weight: 700;
            border-bottom: 2px solid #29B6F6;
        }

        /* Marquee Animation */
        .m-marquee-wrap {
            width: 100vw;
            margin-left: -20px;
            /* Counteract parent padding */
            overflow: hidden;
            padding: 30px 0 60px;
            position: relative;
            background: #111;
            /* Match bg */
            /* Smooth fade sides */
            mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 10%, black 90%, transparent 100%);
        }

        .m-marquee-track {
            display: flex;
            gap: 16px;
            width: max-content;
            animation: mScroll 20s linear infinite;
            will-change: transform;
        }

        .m-team-card {
            width: 180px;
            height: 240px;
            flex-shrink: 0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            border: 4px solid #fff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .m-team-card:nth-child(odd) {
            transform: rotate(-3deg);
            margin-top: 10px;
            border-color: #29B6F6;
        }

        .m-team-card:nth-child(even) {
            transform: rotate(3deg);
            margin-bottom: 10px;
            border-color: #BDFF00;
        }

        .m-team-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes mScroll {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }

            /* Assuming content is duplicated */
        }


        .m-cta-section {
            background-color: #111;
            padding: 60px 20px 80px;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            color: #fff;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .m-cta-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 16px;
            text-transform: uppercase;
            line-height: 1.1;
        }

        .m-cta-sub {
            font-size: 16px;
            color: #ccc;
            margin-bottom: 32px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .m-cta-btn {
            display: inline-block;
            background: #29B6F6;
            color: #ffffff !important;
            font-weight: 800;
            text-transform: uppercase;
            padding: 18px 40px;
            border-radius: 20px;
            font-size: 16px;
            text-decoration: none;
            box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4);
            transition: transform 0.2s;
        }

        .m-cta-btn:active {
            transform: scale(0.95);
        }


        :root {
            --color-bg: #f2f2f7;
            --color-card: #ffffff;
            --color-text-main: #1d1d1f;
            --color-text-second: #86868b;
            --color-accent: #007aff;
            --color-error: #ff3b30;
            --color-success: #34c759;
            --border-radius: 20px;
            --border-color: #d1d1d6;
            --border-light: #e5e5ea;
        }

        /* SCOPED RESET - Only affects widget elements */
        #widget-overlay *,
        #widget-overlay *::before,
        #widget-overlay *::after {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* EXTERNAL RESETS for Plugins (Flatpickr, Rolldate) */
        .flatpickr-calendar,
        .flatpickr-calendar * {
            box-sizing: border-box;
        }

        .rolldate-container,
        .rolldate-container * {
            box-sizing: border-box;
        }

        /* KEYFRAMES GLOBAL */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        /* --- BUTTON HIDDEN (Triggered via hash) --- */
        .open-modal-btn {
            display: none;
        }

        /* --- MODAL OVERLAY --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            /* Font reset for the widget context */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--color-text-main);
            line-height: 1.5;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* --- WIDGET CONTAINER (FIXED HEIGHT POPUP) --- */
        .widget-container {
            width: 100%;
            max-width: 480px;
            height: 600px;
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s ease;
            text-align: left;
        }

        .modal-overlay.active .widget-container {
            transform: scale(1);
        }

        /* --- HEADER --- */
        .widget-header {
            flex-shrink: 0;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid var(--border-light);
            z-index: 20;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            background: #f2f2f7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #8e8e93;
            font-weight: 600;
            transition: 0.2s;
        }

        .close-btn:hover {
            color: #1d1d1f;
            background: #e5e5ea;
        }

        .stepper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0.4;
            transition: 0.3s;
        }

        .step-item.active {
            opacity: 1;
        }

        .step-item span {
            font-size: 14px;
            font-weight: 600;
            display: none;
        }

        .step-item.active span {
            display: block;
            color: var(--color-text-main);
        }

        .step-circle {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #c7c7cc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            color: #8e8e93;
        }

        .step-item.active .step-circle {
            border-color: var(--color-accent);
            background: var(--color-accent);
            color: #fff;
        }

        .step-item.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: #fff;
            content: '✓';
        }

        /* --- MAIN SCROLLABLE AREA --- */
        .widget-body {
            position: relative;
            flex: 1;
            overflow: hidden;
            background: #fff;
        }

        .step-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 24px;
            padding-bottom: 20px;
            background: #fff;
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s;
            opacity: 0;
            transform: translateX(50px);
            display: none;
        }

        .step-slide.active {
            opacity: 1;
            transform: translateX(0);
            display: block;
        }

        .step-slide>*:last-child {
            margin-bottom: 20px;
        }

        .slide-enter-next {
            animation: slideInRight 0.4s forwards;
        }

        .slide-exit-next {
            animation: slideOutLeft 0.4s forwards;
            z-index: 0;
        }

        .slide-enter-prev {
            animation: slideInLeft 0.4s forwards;
        }

        .slide-exit-prev {
            animation: slideOutRight 0.4s forwards;
            z-index: 0;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutLeft {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(-30%);
                opacity: 0;
            }
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-30%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* --- STICKY FOOTER --- */
        .widget-footer {
            flex-shrink: 0;
            padding: 16px 24px;
            background: #fff;
            border-top: 1px solid var(--border-light);
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* --- UI ELEMENTS (Scoped) --- */
        .widget-container h2 {
            margin: 0 0 24px 0;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: var(--color-text-main);
        }

        .plan-card {
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .plan-card:hover {
            border-color: #b0b0b8;
        }

        .plan-card.selected {
            border-color: var(--color-accent);
            background: rgba(0, 122, 255, 0.03);
        }

        .radio-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #d1d1d6;
            margin-top: 2px;
            position: relative;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .plan-card.selected .radio-circle {
            border-color: var(--color-accent);
            background: var(--color-accent);
        }

        .plan-card.selected .radio-circle::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
        }

        .counter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 24px 0;
        }

        .counter-label {
            font-size: 16px;
            font-weight: 600;
        }

        .counter-ctrl {
            background: #f2f2f7;
            border-radius: 12px;
            display: flex;
            align-items: center;
            padding: 4px;
        }

        .c-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            border-radius: 8px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            user-select: none;
        }

        .c-btn:active {
            transform: scale(0.95);
        }

        .c-val {
            width: 40px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: var(--color-accent);
            color: #fff;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-primary:disabled {
            background: #e5e5ea;
            color: #8e8e93;
            cursor: not-allowed;
        }

        .btn-secondary {
            width: 100%;
            padding: 14px;
            background: transparent;
            color: var(--color-accent);
            border: none;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-secondary:hover {
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 16px;
            position: relative;
        }

        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: #86868b;
            margin-bottom: 6px;
            display: block;
        }

        .inp-field {
            width: 100%;
            height: 50px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0 16px;
            font-size: 16px;
            outline: none;
            transition: 0.2s;
            -webkit-appearance: none;
            appearance: none;
            background: #fff;
        }

        .inp-field:focus {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        .inp-field.error {
            border-color: var(--color-error);
            background: #fff0f0;
        }

        .input-error-msg {
            color: var(--color-error);
            font-size: 11px;
            margin-top: 4px;
            display: none;
        }

        .inp-field.error+.input-error-msg {
            display: block;
        }

        .stripe-box {
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: #fff;
        }

        .stripe-box:focus-within {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        /* PAYMENT LOADER */
        #payment-loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #payment-loader.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .vibey-loader {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e5ea;
            border-top-color: var(--color-accent);
            border-radius: 50%;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            /* Ensure it renders */
            display: block;
            box-sizing: border-box;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .modal-overlay {
                align-items: flex-end;
                padding: 0;
            }

            .widget-container {
                max-height: 85vh;
                height: 85vh;
                border-radius: 24px 24px 0 0;
                transform: translateY(100%);
                max-width: 100%;
            }

            .modal-overlay.active .widget-container {
                transform: translateY(0);
            }
        }

        .shake {
            animation: shake 0.4s;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0)
            }

            25% {
                transform: translateX(-5px)
            }

            75% {
                transform: translateX(5px)
            }
        }

        /* PLUGIN Z-INDEX FIXES */
        .flatpickr-calendar {
            z-index: 20000 !important;
        }

        .iti__country-list {
            z-index: 20000 !important;
        }

        .rolldate-container {
            z-index: 20000 !important;
        }

        /* Rolldate z-index */

        .iti {
            width: 100%;
            display: block;
        }
    </style>

    <!-- CONTENT PART 1 -->
    <!-- BLOCK 2: MAIN CONTENT (DUAL VIEW) -->
    <div class="desktop-view">

        <!-- DESKTOP SOURCE: Двухдневка в Альпы/01_Hero.html -->




        <div class="hero-wrapper">
            <div class="hero-overlay"></div>

            <div class="hero-header">
                <a href="/" class="hero-logo">
                    <img src="https://static.tildacdn.com/tild6534-3663-4838-b563-336463663732/Kover_travel_logo.svg"
                        alt="Kover Travel">
                </a>
                <div class="hero-socials">
                    <a href="https://www.instagram.com/kover_travel" target="_blank" class="social-icon">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path
                                d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"
                                fill="white" />
                        </svg>
                    </a>
                    <a href="https://t.me/koverevents" target="_blank" class="social-icon">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path
                                d="M20.665 3.717l-17.73 6.837c-1.21.486-1.203 1.161-.222 1.462l4.552 1.42 10.532-6.645c.498-.303.953-.14.579.192l-8.533 7.701h-.002l-.002.001-.314 4.692c.46 0 .663-.211.921-.46l2.211-2.15 4.599 3.397c.848.467 1.457.227 1.668-.785l3.019-14.228c.309-1.239-.473-1.8-1.282-1.434z"
                                fill="white" />
                        </svg>
                    </a>
                </div>
            </div>

            <div class="hero-content-wrapper">
                <div class="hero-glass-card">
                    <div class="hero-meta">
                        <div class="hero-date-badge">&#128197; 13 - 15 МАРТА</div>
                        <div class="hero-price-badge">&#128184; 5 699 KC</div>
                        <div class="hero-tag">RETREAT</div>
                    </div>

                    <h1 class="hero-title">РЕТРИТ В <span>КРКОНОШЕ</span></h1>

                    <p class="hero-subtitle">
                        Горы, тишина и полная перезагрузка.<br>
                        3 дня, чтобы замедлиться, выдохнуть и побыть среди природы.
                    </p>

                    <button type="button" onclick="openWidget(); return false;" class="hero-btn kover-btn"
                        style="box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4);">ПРИСОЕДИНИТЬСЯ</button>
                </div>
            </div>
        </div>

        <!-- DESKTOP SOURCE: Двухдневка в Альпы/02_Program.html -->



        <div class="d-program-section">
            <div class="d-container">
                <div class="d-section-header">
                    <h2 class="d-title">Программа тура</h2>
                    <p class="d-subtitle">Максимум впечатлений за 48 часов. Мы продумали каждую деталь, чтобы вы просто
                        наслаждались моментом.</p>
                </div>

                <div class="d-program-grid">

                    <!-- 1. Yoga & Meditation -->
                    <div class="d-card" onclick="openDesktopModal('yoga')">
                        <img src="https://kovertrip.b-cdn.net/images/IMG_8703.webp" class="d-card-img">
                        <div class="d-card-tags">
                            <span class="d-tag">Релакс</span>
                            <span class="d-tag">Практики</span>
                        </div>
                        <div class="d-card-overlay">
                            <div class="d-card-title">Йога и Медитации</div>
                            <div class="d-card-desc">Восстановление внутреннего баланса в окружении гор.</div>
                            <div class="d-card-btn">Подробнее &rarr;</div>
                        </div>

                        <!-- DATA -->
                        <div class="d-hidden-data" id="d-data-yoga" style="display:none;">
                            <div class="title">Йога и Медитации</div>
                            <div class="subtitle">Тишина · Дыхание · Звуковой массаж</div>
                            <!-- Gallery Images -->
                            <div class="gallery-images">
                                <img src="https://kovertrip.b-cdn.net/images/IMG_8703.webp">
                            </div>
                            <!-- Content -->
                            <div class="content">
                                <p class="d-modal-text">
                                    Мы едем в Крконоше не просто гулять, а <b>замедляться</b>.
                                    <br><br>
                                    Каждое утро начинаем с мягкой практики йоги и дыхания. Это поможет настроиться на
                                    день, отпустить городскую суету и почувствовать свое тело.
                                </p>

                                <div class="d-modal-h">&#129496; Звуковой массаж</div>
                                <p class="d-modal-text">
                                    Особенный опыт с тибетскими чашами. Глубокое расслабление через звук, которое
                                    снимает напряжение и успокаивает ум.
                                </p>

                                <div class="d-modal-quote">"Горы, тишина и полная перезагрузка."</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Active -->
                <div class="d-card" onclick="openDesktopModal('active')">
                    <img src="https://kovertrip.b-cdn.net/images/IMG_4037.webp" class="d-card-img">
                    <div class="d-card-tags">
                        <span class="d-tag lime">Активность</span>
                        <span class="d-tag lime">Природа</span>
                    </div>
                    <div class="d-card-overlay">
                        <div class="d-card-title">Активный отдых</div>
                        <div class="d-card-desc">Лыжи, санки или прогулки по зимнему лесу.</div>
                        <div class="d-card-btn">Подробнее &rarr;</div>
                    </div>
                    <div class="d-hidden-data" id="d-data-active" style="display:none;">
                        <div class="title">Лыжи и Прогулки</div>
                        <div class="subtitle">Крконоше · Свежий воздух</div>
                        <div class="gallery-images">
                            <img src="https://kovertrip.b-cdn.net/images/IMG_4037.webp">
                        </div>
                        <div class="content">
                            <p class="d-modal-text"><b>По погоде и настроению.</b><br>
                                Если будет снег — мы идем кататься на лыжах или санках. Местные трассы отлично подходят
                                для этого.</p>

                            <div class="d-modal-h">&#127794; Лесные прогулки</div>
                            <p class="d-modal-text">Если снега будет мало — нас ждут живописные лесные тропы. Чистейший
                                горный воздух, тишина и хруст веток под ногами. Идеальное время, чтобы отключить телефон
                                и просто смотреть вокруг.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Atmosphere -->
            <div class="d-card" onclick="openDesktopModal('atmosphere')">
                <img src="https://kovertrip.b-cdn.net/images/804959505.webp" class="d-card-img">
                <div class="d-card-tags">
                    <span class="d-tag">Уют</span>
                    <span class="d-tag">Камин</span>
                </div>
                <div class="d-card-overlay">
                    <div class="d-card-title">Вечера у камина</div>
                    <div class="d-card-desc">Теплые разговоры, чай и атмосфера дома.</div>
                    <div class="d-card-btn">Подробнее &rarr;</div>
                </div>

                <div class="d-hidden-data" id="d-data-atmosphere" style="display:none;">
                    <div class="title">Атмосфера</div>
                    <div class="subtitle">Уют · Общение · Тепло</div>
                    <div class="gallery-images">
                        <img src="https://kovertrip.b-cdn.net/images/804959505.webp">
                    </div>
                    <div class="content">
                        <p class="d-modal-text">
                            Вечера в этом туре особенные. Мы собираемся у камина, пьем горячий чай (или глинтвейн) и
                            просто общаемся.
                            <br><br>
                            Здесь можно быть собой, смеяться, делиться историями или просто молчать, глядя на огонь. Это
                            то самое чувство "хюгге", которого так не хватает в городе.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Red Bull -->
        <!-- Cards Removed -->

    </div>
    </div>
    </div>

    <!-- DESKTOP MODAL Structure -->
    <div class="d-modal-overlay" id="desktopModal" onclick="closeDesktopModal()">
        <div class="d-modal-container" onclick="event.stopPropagation()">
            <div class="d-modal-close" onclick="closeDesktopModal()">&times;</div>

            <div class="d-modal-left">
                <img src="" class="d-gallery-main active" id="d-main-img">
                <!-- Thumbs container populated by JS -->
                <div class="d-gallery-thumbs" id="d-thumbs"></div>
            </div>

            <div class="d-modal-right">
                <div>
                    <h3 class="d-modal-title" id="d-modal-title">Title</h3>
                    <div class="d-modal-subtitle" id="d-modal-subtitle">Subtitle</div>
                    <div id="d-modal-content"></div>
                </div>

                <div style="margin-top:auto;">
                    <button onclick="openWidget()"
                        style="background:#29B6F6; color:white; border:none; padding:20px; width:100%; border-radius:12px; font-weight:800; cursor:pointer; font-size:16px; text-transform:uppercase; box-shadow:0 10px 30px rgba(41, 182, 246, 0.4); transition: transform 0.2s;">
                        Я в деле! Занять место
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openDesktopModal(id) {
            const data = document.getElementById('d-data-' + id);
            if (!data) return;

            // 1. Text Content
            document.getElementById('d-modal-title').innerText = data.querySelector('.title').innerText;
            document.getElementById('d-modal-subtitle').innerText = data.querySelector('.subtitle').innerText;
            document.getElementById('d-modal-content').innerHTML = data.querySelector('.content').innerHTML;

            // 2. Gallery Logic
            const images = data.querySelectorAll('.gallery-images img');
            const thumbsContainer = document.getElementById('d-thumbs');
            const mainImg = document.getElementById('d-main-img');

            thumbsContainer.innerHTML = '';

            if (images.length > 0) {
                mainImg.src = images[0].src;

                // Generate Thumbs
                images.forEach((img, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = img.src;
                    thumb.className = 'd-thumb' + (index === 0 ? ' active' : '');
                    thumb.onclick = () => {
                        mainImg.src = img.src;
                        document.querySelectorAll('.d-thumb').forEach(t => t.classList.remove('active'));
                        thumb.classList.add('active');
                        mainImg.style.opacity = 0;
                        setTimeout(() => mainImg.style.opacity = 1, 50);
                    };
                    thumbsContainer.appendChild(thumb);
                });
                thumbsContainer.style.display = 'flex';
            } else {
                thumbsContainer.style.display = 'none';
            }

            const overlay = document.getElementById('desktopModal');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDesktopModal() {
            document.getElementById('desktopModal').classList.remove('active');
            document.body.style.overflow = '';
        }
    </script>

    <!-- DESKTOP SOURCE: Двухдневка в Альпы/08_Timeline.html -->



    <div class="d-time-section">
        <div class="d-time-header">
            <h2 class="d-time-title">Тайминг путешествия</h2>
        </div>

        <div class="d-days-grid">
            <!-- DAY 1 & 2 -->
            <div class="d-day-col">
                <div class="d-day-header">&#128197; 13 Марта (Четверг)</div>
                <div class="d-t-item">
                    <div class="d-t-time">18:00</div>
                    <div class="d-t-desc"><strong>Выезд</strong> Сбор и отправление в Крконоше.</div>
                </div>
                <div class="d-t-item">
                    <div class="d-t-time">21:00</div>
                    <div class="d-t-desc"><strong>Заселение</strong> Прибытие, знакомство и отдых.</div>
                </div>

                <div class="d-day-header" style="margin-top: 40px;">&#128197; 14 Марта (Пятница)</div>
                <div class="d-t-item">
                    <div class="d-t-time">Утро</div>
                    <div class="d-t-desc"><strong>Практики</strong> Йога, дыхание, настройка на день.</div>
                </div>
                <div class="d-t-item">
                    <div class="d-t-time">День</div>
                    <div class="d-t-desc"><strong>Активность</strong> Лыжи, санки или прогулки.</div>
                </div>
            </div>

            <!-- DAY 3 -->
            <div class="d-day-col">
                <div class="d-day-header">&#128197; 15 Марта (Суббота)</div>
                <div class="d-t-item">
                    <div class="d-t-time">Утро</div>
                    <div class="d-t-desc"><strong>Йога</strong> Утренняя практика и завтрак.</div>
                </div>
                <div class="d-t-item">
                    <div class="d-t-time">День</div>
                    <div class="d-t-desc"><strong>Релакс</strong> Звуковой массаж, свободное время.</div>
                </div>
                <div class="d-t-item">
                    <div class="d-t-time">16:00</div>
                    <div class="d-t-desc"><strong>Выезд</strong> Отправление в Прагу.</div>
                </div>
                <div class="d-t-item">
                    <div class="d-t-time">19:00</div>
                    <div class="d-t-desc"><strong>Дома</strong> Ориентировочное прибытие.</div>
                </div>
            </div>
        </div>

        <div style="text-align:center; margin-top:60px;">
            <button onclick="openWidget()" class="kover-btn"
                style="background:#29B6F6; color:#fff !important; border:none; padding:24px 60px; border-radius:20px; font-size:20px; font-weight:800; cursor:pointer; text-transform:uppercase; box-shadow: 0 10px 40px rgba(41, 182, 246, 0.4); transition: transform 0.2s; min-width: 280px; display: inline-block;">
                ЗАБРОНИРОВАТЬ ТУР
            </button>
        </div>
    </div>

    <!-- DESKTOP SOURCE: Двухдневка в Альпы/10_Reviews_Desktop.html -->



    <div class="d-reviews-section">
        <div class="d-reviews-container">
            <header class="d-reviews-header">
                <h2 class="d-reviews-title">Что говорят наши путешественники</h2>
                <div class="d-reviews-badge">
                    <span>⭐ Оценка 9.5 из 10 (250+ туров)</span>
                </div>
            </header>

            <div class="d-reviews-grid" id="dReviewsGrid">
                <!-- Items injected by JS -->
            </div>

            <div class="d-cta-wrap">
                <a href="javascript:openWidget()" class="d-btn-primary kover-btn">Хочу поехать с вами</a>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const dReviews = [
                {
                    type: 'video',
                    videoUrl: 'https://vz-244f7910-31a.b-cdn.net/b852d126-3944-4fc9-860a-75009851d9bb/play_720p.mp4',
                    posterUrl: 'https://581522.b-cdn.net/b852d126-3944-4fc9-860a-75009851d9bb/thumbnail.jpg',
                    tourName: 'Ретрит: Перезагрузка'
                },
                {
                    type: 'hybrid',
                    videoUrl: 'https://vz-244f7910-31a.b-cdn.net/e3e6f8c6-04d5-4068-b0d1-6bfa2e163c37/play_720p.mp4',
                    statNumber: '85%',
                    statDesc: 'участников едут с нами снова',
                    tourName: 'Эмоции бесценны'
                },
                {
                    type: 'video',
                    videoUrl: 'https://vz-244f7910-31a.b-cdn.net/f446d1cd-7fad-4cc8-afb2-8a5e73a9e475/play_720p.mp4',
                    posterUrl: 'https://581522.b-cdn.net/f446d1cd-7fad-4cc8-afb2-8a5e73a9e475/thumbnail.jpg',
                    tourName: 'Ретрит: Перезагрузка'
                }
            ];

            const container = document.getElementById('dReviewsGrid');
            const playIcon = '<svg class="d-play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';

            dReviews.forEach(item => {
                let html = '';
                if (item.type === 'video') {
                    html = `
                <div class="d-review-card d-card-video" onclick="dToggleVideo(this)">
                    <video class="d-rv-video" src="${item.videoUrl}#t=0.1" playsinline loop muted preload="metadata"></video>
                    <div class="d-rv-overlay"></div>
                    <div class="d-badg-bottom">${item.tourName}</div>
                    <div class="d-rv-play-btn">${playIcon}</div>
                </div>`;
                } else if (item.type === 'hybrid') {
                    html = `
                <div class="d-review-card d-card-hybrid">
                    <div class="d-hybrid-video" onclick="dToggleVideo(this)">
                        <video style="width:100%; height:100%; object-fit:cover;" src="${item.videoUrl}#t=0.1" playsinline loop muted preload="metadata"></video>
                         <div class="d-rv-play-btn" style="width:50px; height:50px;">${playIcon}</div>
                    </div>
                    <div class="d-hybrid-stat">
                        <div class="d-stat-num">${item.statNumber}</div>
                        <div class="d-stat-text">${item.statDesc}</div>
                    </div>
                </div>`;
                }
                container.insertAdjacentHTML('beforeend', html);
            });

            window.dToggleVideo = function (el) {
                const vid = el.querySelector('video');
                if (!vid) return;

                // Pause all others
                document.querySelectorAll('.d-review-card video').forEach(v => {
                    if (v !== vid) {
                        v.pause();
                        v.closest('.d-review-card')?.classList.remove('is-playing');
                        v.closest('.d-hybrid-video')?.classList.remove('is-playing');
                    }
                });

                if (vid.paused) {
                    vid.muted = false;
                    vid.play();
                    el.classList.add('is-playing');
                } else {
                    vid.pause();
                    el.classList.remove('is-playing');
                }
            }

        })();
    </script>

    <!-- DESKTOP SOURCE: Двухдневка в Альпы/09_OrgDetails.html -->



    <div class="d-org-section">
        <div class="d-org-container">
            <h2 class="d-org-h2">Стоимость:</h2>

            <!-- Included -->
            <div class="d-info-card accent">
                <div class="d-info-h">
                    <span>Включено</span>
                    <span class="d-price-large">5 699 KC</span>
                </div>
                <ul class="d-list">
                    <li class="check">Трансфер туда и обратно</li>
                    <li class="check">Проживание (3 дня)</li>
                    <li class="check">Йога и медитации</li>
                    <li class="check">Дыхательные практики</li>
                    <li class="check">Звуковой массаж чашами</li>
                    <li class="check">Вечерние программы</li>
                    <li class="check">Сопровождение организаторов</li>
                    <li class="check">Профессиональный фотоотчет</li>
                </ul>
            </div>

            <!-- Extra -->
            <div class="d-info-card">
                <div class="d-info-h">
                    <span>Не включено</span>
                </div>
                <ul class="d-list">
                    <li>• Подъемник: 23 евро</li>
                    <li>• Аренда саней: 11 евро</li>
                    <li>• Обеды и ужины</li>
                </ul>
            </div>

            <!-- Clothing -->
            <div class="d-clothing">
                <div class="d-clothing-icon">&#10052;️</div>
                <div class="d-clothing-text">
                    <strong>Что надеть?</strong><br>
                    Одевайся удобно и тепло! Идеально — непромокаемые штаны + теплая куртка. Не забудь
                    перчатки, шапку и удобную зимнюю обувь.
                </div>
            </div>
        </div>
    </div>

    <!-- DESKTOP SOURCE: Двухдневка в Альпы/10_HowItWorks.html -->



    <div class="d-how-section">
        <div class="d-how-container">
            <div class="d-how-header">
                <h2 class="d-how-title">Как это работает</h2>
            </div>

            <div class="d-how-grid">
                <!-- Step 1 -->
                <div class="d-how-item">
                    <div class="d-how-icon-box">
                        <svg viewBox="0 0 24 24">
                            <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                            <line x1="2" y1="10" x2="22" y2="10"></line>
                        </svg>
                    </div>
                    <h3 class="d-how-h3">1. Забронируй</h3>
                    <p class="d-how-p">Оплата картой (Apple Pay / Google Pay). Место закрепится за тобой
                        моментально.</p>
                </div>

                <!-- Step 2 -->
                <div class="d-how-item">
                    <div class="d-how-icon-box">
                        <svg viewBox="0 0 24 24">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                    <h3 class="d-how-h3">2. Вступай в чат</h3>
                    <p class="d-how-p">Сразу после оплаты ты получишь ссылку на Telegram-чат тура. Там вся тусовка и
                        организаторы.</p>
                </div>

                <!-- Step 3 -->
                <div class="d-how-item">
                    <div class="d-how-icon-box">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" />
                            <circle cx="7" cy="17" r="2" />
                            <circle cx="17" cy="17" r="2" />
                            <path d="M5 17h2v-6h10v6h2" />
                        </svg>
                    </div>
                    <h3 class="d-how-h3">3. Погнали!</h3>
                    <p class="d-how-p">В четверг в 18:00 встречаемся у автобуса. Загружаемся и мчим в Крконоше.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- DESKTOP SOURCE: Двухдневка в Альпы/11_Team.html -->



    <div class="d-team-section">
        <div class="d-team-container">
            <h2 class="d-team-title">Мы про жизнь, а не просто локации</h2>

            <div class="d-team-tags">
                <span class="d-team-tag accent">#koverfamily</span>
                <span class="d-team-tag">#freedom</span>
                <span class="d-team-tag">#emotions</span>
            </div>

            <p class="d-team-subtitle">
                Мы — команда людей, у которых в крови движ. Kover Travel родился не в офисе, а в дороге.<br>
                Мы создаем трипы, где каждый день — это <b style="color:white; border-bottom: 2px solid #29B6F6;">кайф и
                    свобода</b>.
                Всё по-настоящему: горы, скорость, смех и ощущение, что ты реально живёшь.
            </p>
        </div>

        <!-- Marquee -->
        <div class="d-marquee-wrap">
            <div class="d-marquee-track">
                <!-- Set 1 -->
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild6639-3338-4839-b762-653938316663/DSCF7839-74.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild3639-3634-4235-b231-353239666166/KOVERStaff_ParisEtre.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild6163-3438-4331-b161-326264363835/DSCF6813.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild3232-3335-4534-b632-643439383466/IMG_3606_1.jpg"
                        class="d-team-img"></div>
                <!-- Set 2 (Duplicate) -->
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild6639-3338-4839-b762-653938316663/DSCF7839-74.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild3639-3634-4235-b231-353239666166/KOVERStaff_ParisEtre.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild6163-3438-4331-b161-326264363835/DSCF6813.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild3232-3335-4534-b632-643439383466/IMG_3606_1.jpg"
                        class="d-team-img"></div>
                <!-- Set 3 -->
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild6639-3338-4839-b762-653938316663/DSCF7839-74.jpg"
                        class="d-team-img"></div>
                <div class="d-team-card"><img
                        src="https://static.tildacdn.com/tild3639-3634-4235-b231-353239666166/KOVERStaff_ParisEtre.jpg"
                        class="d-team-img"></div>
            </div>
        </div>
    </div>

    <!-- DESKTOP SOURCE: Двухдневка в Альпы/10b_CTA.html -->



    <div class="d-cta-section">
        <h2 class="d-cta-title">Готов к приключению?</h2>
        <p class="d-cta-sub">Места в автобусе разбирают быстро. Не откладывай жизнь на потом.</p>
        <a href="#widget" onclick="openWidget()" class="d-cta-btn kover-btn">Занять место</a>
    </div>
    </div><!-- END DESKTOP -->
    <!-- CONTENT PART 2 -->

    <div class="mobile-view">

        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/01_Hero_Mobile.html -->



        <div class="m-hero">
            <div class="m-header">
                <a href="/" class="m-logo">
                    <img src="https://static.tildacdn.com/tild6534-3663-4838-b563-336463663732/Kover_travel_logo.svg"
                        alt="Kover Logo">
                </a>
            </div>

            <div class="m-hero-content">
                <div class="m-badges">
                    <div class="m-badge">&#128197; 13 - 15 марта</div>
                    <div class="m-badge accent">&#128184; 5 699 KC</div>
                </div>

                <h1 class="m-title">В ГОРЫ: <span>ПЕРЕЗАГРУЗКА</span> В КРКОНОШЕ</h1>

                <p class="m-subtitle">
                    Йога, медитации, дыхательные практики и вечерние разговоры у камина. <br>
                    Время замедлиться и побыть среди природы.
                </p>

                <button onclick="openWidget()" class="m-cta-btn kover-btn">Присоединиться</button>
            </div>
        </div>



        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/02_Program_Mobile.html -->



        <div class="m-program-section">
            <div class="m-section-header">
                <h2 class="m-h2">Программа тура</h2>
                <!-- Removed Tap hint -->
            </div>

            <div class="m-prog-scroll">

                <!-- Card 1: Yoga -->
                <div class="m-story-card" onclick="openPopup('yoga')">
                    <img src="https://kovertrip.b-cdn.net/images/IMG_8703.webp" class="m-story-img" alt="Yoga">
                    <div class="m-story-tags">
                        <span class="m-story-tag">Релакс</span>
                        <span class="m-story-tag">Практики</span>
                    </div>
                    <div class="m-story-overlay">
                        <h3 class="m-story-title">Йога и Медитации</h3>
                        <p class="m-story-desc">Восстановление внутреннего баланса в окружении гор.</p>
                        <div class="m-story-btn">Смотреть &rarr;</div>
                    </div>
                    <!-- Data for Popup -->
                    <div class="popup-data" id="data-yoga" style="display:none;">
                        <div class="title">Йога и Медитации</div>
                        <div class="subtitle">Тишина · Дыхание · Звуковой массаж</div>
                        <div class="images">
                            <img src="https://kovertrip.b-cdn.net/images/IMG_8703.webp">
                        </div>
                        <div class="content">
                            <p class="m-article-text">
                                Мы едем в Крконоше не просто гулять, а <b>замедляться</b>.
                                <br><br>
                                Каждое утро начинаем с мягкой практики йоги и дыхания. Это поможет настроиться на день,
                                отпустить городскую суету и почувствовать свое тело.
                            </p>

                            <div class="m-article-h">&#129496; Звуковой массаж</div>
                            <p class="m-article-text">
                                Особенный опыт с тибетскими чашами. Глубокое расслабление через звук, которое снимает
                                напряжение и успокаивает ум.
                            </p>

                            <div class="m-quote-card">
                                "Горы, тишина и полная перезагрузка."
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Active -->
                <div class="m-story-card" onclick="openPopup('active')">
                    <img src="https://kovertrip.b-cdn.net/images/IMG_4037.webp" class="m-story-img" alt="Active">
                    <div class="m-story-tags">
                        <span class="m-story-tag lime">Активность</span>
                        <span class="m-story-tag lime">Природа</span>
                    </div>
                    <div class="m-story-overlay">
                        <h3 class="m-story-title">Активный отдых</h3>
                        <p class="m-story-desc">Лыжи, санки или прогулки по зимнему лесу.</p>
                        <div class="m-story-btn" style="background:#BDFF00; color:black;">Смотреть &rarr;</div>
                    </div>
                    <div class="popup-data" id="data-active" style="display:none;">
                        <div class="title">Лыжи и Прогулки</div>
                        <div class="subtitle">Крконоше · Свежий воздух</div>
                        <div class="images">
                            <img src="https://kovertrip.b-cdn.net/images/IMG_4037.webp">
                        </div>
                        <div class="content">
                            <p class="m-article-text">
                                <b>По погоде и настроению.</b><br>
                                Если будет снег — мы идем кататься на лыжах или санках. Местные трассы отлично подходят
                                для этого.
                            </p>

                            <div class="m-article-h">&#127794; Лесные прогулки</div>
                            <p class="m-article-text">
                                Если снега будет мало — нас ждут живописные лесные тропы. Чистейший горный воздух,
                                тишина и хруст веток под ногами. Идеальное время, чтобы отключить телефон и просто
                                смотреть вокруг.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Atmosphere -->
                <div class="m-story-card" onclick="openPopup('atmosphere')">
                    <img src="https://kovertrip.b-cdn.net/images/804959505.webp" class="m-story-img" alt="Atmosphere">
                    <div class="m-story-tags">
                        <span class="m-story-tag">Уют</span>
                        <span class="m-story-tag">Камин</span>
                    </div>
                    <div class="m-story-overlay">
                        <h3 class="m-story-title">Вечера у камина</h3>
                        <p class="m-story-desc">Теплые разговоры, чай и атмосфера дома.</p>
                        <div class="m-story-btn">Смотреть &rarr;</div>
                    </div>
                    <div class="popup-data" id="data-atmosphere" style="display:none;">
                        <div class="title">Атмосфера</div>
                        <div class="subtitle">Уют · Общение · Тепло</div>
                        <div class="images">
                            <img src="https://kovertrip.b-cdn.net/images/804959505.webp">
                        </div>
                        <div class="content">
                            <p class="m-article-text">
                                Вечера в этом туре особенные. Мы собираемся у камина, пьем горячий чай (или глинтвейн) и
                                просто общаемся.
                                <br><br>
                                Здесь можно быть собой, смеяться, делиться историями или просто молчать, глядя на огонь.
                                Это то самое чувство "хюгге", которого так не хватает в городе.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Cards Removed -->

                <div style="min-width: 1px;"></div>
                <!-- Spacer -->
            </div>

            <!-- POPUP COMPONENT -->
            <div id="m-popup" class="m-popup-overlay" onclick="closePopup()">
                <div class="m-popup-sheet" onclick="event.stopPropagation()">
                    <!-- Close Button -->
                    <div class="m-close-round" onclick="closePopup()">&times;</div>

                    <!-- Gallery Slider -->
                    <div class="m-gallery-container">
                        <div class="m-gallery-scroll" id="gallery-track">
                            <!-- Images injected by JS -->
                        </div>
                        <div class="m-photo-count" id="photo-counter">
                            &#128247; 1/5
                        </div>
                        <div class="m-gallery-dots" id="gallery-dots">
                            <!-- Dots injected by JS -->
                        </div>
                    </div>

                    <div class="m-popup-content">
                        <div class="m-sheet-header">
                            <div class="m-sheet-handle"></div>
                        </div>
                        <h3 id="popup-title" class="m-popup-title">Title</h3>
                        <div id="popup-subtitle" class="m-popup-subtitle">Subtitle</div>
                        <div id="popup-text"></div> <!-- HTML Container -->

                        <button onclick="closePopup()" class="m-sticky-close">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function openPopup(id) {
                const dataDiv = document.getElementById('data-' + id);
                if (!dataDiv) return;

                // 1. Get Text Data
                const title = dataDiv.querySelector('.title').innerText;
                const subtitle = dataDiv.querySelector('.subtitle') ? dataDiv.querySelector('.subtitle').innerText : '';
                // Get InnerHTML for the content to support rich text
                const content = dataDiv.querySelector('.content').innerHTML;

                document.getElementById('popup-title').innerText = title;
                document.getElementById('popup-subtitle').innerText = subtitle;
                document.getElementById('popup-text').innerHTML = content;

                // 2. Build Gallery
                const images = dataDiv.querySelectorAll('.images img');
                const track = document.getElementById('gallery-track');
                const dotsContainer = document.getElementById('gallery-dots');

                track.innerHTML = '';
                dotsContainer.innerHTML = '';

                images.forEach((img, index) => {
                    // Add Image
                    const imgEl = document.createElement('img');
                    imgEl.src = img.src;
                    imgEl.className = 'm-gallery-img';
                    track.appendChild(imgEl);

                    // Add Dot (only if > 1 image)
                    if (images.length > 1) {
                        const dot = document.createElement('div');
                        dot.className = 'm-dot' + (index === 0 ? ' active' : '');
                        dotsContainer.appendChild(dot);
                    }
                });

                // 3. Setup Scroll Listener for Dots
                if (images.length > 1) {
                    track.onscroll = () => {
                        const scrollLeft = track.scrollLeft;
                        const width = track.offsetWidth;
                        const index = Math.round(scrollLeft / width);

                        // Update dots
                        const dots = dotsContainer.querySelectorAll('.m-dot');
                        dots.forEach(d => d.classList.remove('active'));
                        if (dots[index]) dots[index].classList.add('active');

                        // Update counter
                        document.getElementById('photo-counter').innerHTML = `&#128247; ${index + 1}/${images.length}`;
                    };

                    // Init counter
                    document.getElementById('photo-counter').innerText = `&#128247; 1/${images.length}`;
                    document.getElementById('photo-counter').style.display = 'flex';
                } else {
                    document.getElementById('photo-counter').style.display = 'none';
                }

                // Show
                document.getElementById('m-popup').classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closePopup() {
                document.getElementById('m-popup').classList.remove('active');
                document.body.style.overflow = '';

                // Stop any playing video when closing popup
                const videos = document.querySelectorAll('video');
                videos.forEach(v => v.pause());
            }

            function toggleVideo(el) {
                const video = el.querySelector('video');

                if (video.paused) {
                    // Pause others
                    document.querySelectorAll('video').forEach(v => {
                        if (v !== video) {
                            v.pause();
                            v.closest('.m-card-video')?.classList.remove('playing');
                        }
                    });

                    video.muted = false;
                    video.play();
                    el.classList.add('playing');
                } else {
                    video.pause();
                    el.classList.remove('playing');
                }
            }
        </script>



        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/03_Reviews_Mobile.html -->



        <section class="reviews-section-v3">
            <div class="container">
                <header class="reviews-header">
                    <h2 class="reviews-title">Что говорят наши путешественники</h2>
                    <div class="rating-badge">
                        <svg class="rating-star" viewBox="0 0 24 24">
                            <path
                                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                        </svg>
                        <span>Оценка 9.5 из 10 (250+ туров)</span>
                    </div>
                </header>
            </div>

            <div class="reviews-track-wrapper" id="reviewsContainerV3"></div>
            <div class="cta-container"><a href="#tour" class="btn-primary">Хочу поехать с вами</a></div>
        </section>

        <script>
            (function () {
                const reviewsData = [
                    {
                        type: 'video',
                        videoUrl: 'https://vz-244f7910-31a.b-cdn.net/b852d126-3944-4fc9-860a-75009851d9bb/play_720p.mp4',
                        posterUrl: 'https://581522.b-cdn.net/b852d126-3944-4fc9-860a-75009851d9bb/thumbnail.jpg',
                        author: 'Путешественник',
                        tourName: 'Ретрит',
                        instagram: '',
                        instagramLink: '#'
                    },
                    {
                        type: 'hybrid_split',
                        videoUrl: 'https://vz-244f7910-31a.b-cdn.net/e3e6f8c6-04d5-4068-b0d1-6bfa2e163c37/play_720p.mp4',
                        author: 'Путешественник',
                        tourName: 'Ретрит',
                        statNumber: '85%',
                        statDesc: 'участников едут с нами снова'
                    },
                    {
                        type: 'video',
                        videoUrl: 'https://vz-244f7910-31a.b-cdn.net/f446d1cd-7fad-4cc8-afb2-8a5e73a9e475/play_720p.mp4',
                        posterUrl: 'https://581522.b-cdn.net/f446d1cd-7fad-4cc8-afb2-8a5e73a9e475/thumbnail.jpg',
                        author: 'Путешественник',
                        tourName: 'Ретрит',
                        instagram: '',
                        instagramLink: '#'
                    }
                ];

                const container = document.getElementById('reviewsContainerV3');
                const icons = {
                    play: '<svg class="rv-play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>',
                    insta: '<svg class="insta-icon" viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/></svg>',
                    star: '<svg class="star-small" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>',
                    applePlay: '<svg class="apple-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>',
                    applePause: '<svg class="apple-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'
                };

                const appleBarsHtml = Array(40).fill('<div class="apple-bar"></div>').join('');

                function createScrollItem(data) {
                    let infoRight = '';
                    if (data.instagram) {
                        const handle = data.instagram.replace('@', '');
                        infoRight = `
                    <a href="https://instagram.com/${handle}" target="_blank" class="sc-insta-pill">
                        <svg class="insta-icon-mini" viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/></svg>
                        <span>${handle}</span>
                    </a>`;
                    }
                    const ratingVal = data.rating || '10/10';
                    const dynamicRating = `<div class="sc-rating-badge"><span>${ratingVal}</span>${icons.star}</div>`;
                    return `
                <div class="review-item-scroll">
                    <div class="mini-header"><img src="${data.avatarUrl}" class="mini-avatar"><div class="mini-name">${data.author}</div>${infoRight}</div>
                    <div class="review-text-body">${data.text}</div>
                    <div class="review-footer">${dynamicRating}<div class="mini-tour">${data.tourName}</div></div>
                </div>`;
                }

                reviewsData.forEach(item => {
                    let cardHtml = '';
                    const videoUrlWithTime = item.videoUrl ? item.videoUrl + '#t=0.1' : '';

                    if (item.type === 'video') {
                        cardHtml = `
                    <div class="review-card review-card--video" onclick="window.reviewsV3.toggleVideo(this)">
                        <video class="review-video" src="${videoUrlWithTime}" playsinline loop muted preload="metadata"></video>
                        <div class="video-overlay"></div>
                        <div class="video-badge-bottom">${item.tourName || 'Ретрит'}</div>
                        <div class="rv-play-btn">${icons.play}</div>
                    </div>`;
                    } else if (item.type === 'hybrid_split') {
                        cardHtml = `
                    <div class="review-card review-card--hybrid-split">
                        <div class="hybrid-video-section">
                            <div class="hybrid-video-wrap" onclick="window.reviewsV3.toggleHybridVideo(this)">
                                <video src="${videoUrlWithTime}" playsinline loop muted preload="metadata"></video>
                                <div class="video-badge-bottom">${item.tourName || 'Ретрит'}</div>
                                <div class="rv-play-btn">${icons.play}</div>
                            </div>
                        </div>
                        <div class="hybrid-stats-section"><div class="hybrid-stat-number">${item.statNumber}</div><div class="hybrid-stat-desc">${item.statDesc}</div></div>
                    </div>`;
                    } else if (item.type === 'apple_audio') {
                        cardHtml = `
                    <div class="review-card review-card--apple">
                        <div class="apple-image-section"><img src="${item.photoUrl}" class="apple-photo" alt="${item.author}"></div>
                        <div class="apple-content-section">
                            <div class="apple-header"><div><div class="apple-name">${item.author}</div><div class="apple-tour">${item.tourName}</div></div></div>
                            <div class="apple-player-row">
                                <div class="apple-play-btn" onclick="window.reviewsV3.toggleAudio(this, '${item.audioUrl}')">${icons.applePlay}${icons.applePause}</div>
                                <div class="apple-waveform-stack"><div class="apple-layer apple-layer-gray">${appleBarsHtml}</div><div class="apple-layer apple-layer-black">${appleBarsHtml}</div></div>
                                <div class="apple-time">0:00</div>
                            </div>
                        </div>
                        <audio class="hidden-audio" preload="metadata" ontimeupdate="window.reviewsV3.updateAudioProgress(this)" onloadedmetadata="window.reviewsV3.initAudioDuration(this)"></audio>
                    </div>`;
                    } else if (item.type === 'scrollable_text') {
                        cardHtml = `<div class="review-card--scrollable"><div class="scroll-track">${item.items.map(sub => createScrollItem(sub)).join('')}</div></div>`;
                    }
                    container.insertAdjacentHTML('beforeend', cardHtml);
                });
                container.insertAdjacentHTML('beforeend', '<div style="flex: 0 0 1px;"></div>');

                // Expose functions safely
                window.reviewsV3 = {
                    toggleVideo: function (el) { playPauseLogic(el, el.querySelector('video')); },
                    toggleHybridVideo: function (el) { playPauseLogic(el, el.querySelector('video')); },
                    toggleAudio: function (btn, url) {
                        const card = btn.closest('.review-card--apple');
                        const audio = card.querySelector('audio');
                        if (audio.paused) {
                            pauseAllMedia();
                            if (!audio.src) audio.src = url;
                            audio.play(); card.classList.add('is-playing');
                        } else {
                            audio.pause(); card.classList.remove('is-playing');
                        }
                    },
                    initAudioDuration: function (audio) {
                        const card = audio.closest('.review-card--apple');
                        const timer = card.querySelector('.apple-time');
                        if (audio.duration) timer.innerText = formatTime(audio.duration);
                    },
                    updateAudioProgress: function (audio) {
                        const card = audio.closest('.review-card--apple');
                        const blackLayer = card.querySelector('.apple-layer-black');
                        const timer = card.querySelector('.apple-time');
                        if (!audio.duration) return;
                        const percentPlayed = (audio.currentTime / audio.duration) * 100;
                        blackLayer.style.clipPath = `inset(0 ${100 - percentPlayed}% 0 0)`;
                        timer.innerText = formatTime(audio.duration - audio.currentTime);
                        if (audio.ended) {
                            card.classList.remove('is-playing');
                            blackLayer.style.clipPath = `inset(0 100% 0 0)`;
                            timer.innerText = formatTime(audio.duration);
                        }
                    }
                };

                function playPauseLogic(wrapper, video) {
                    if (event.target.closest('a') || !video) return;
                    if (video.paused) {
                        pauseAllMedia(); video.muted = false; video.play(); wrapper.classList.add('is-playing');
                    } else {
                        video.pause(); wrapper.classList.remove('is-playing');
                    }
                }
                function pauseAllMedia() {
                    const section = document.querySelector('.reviews-section-v3');
                    section.querySelectorAll('video').forEach(v => { v.pause(); v.closest('.review-card--video, .hybrid-video-wrap')?.classList.remove('is-playing'); });
                    section.querySelectorAll('audio').forEach(a => { a.pause(); a.closest('.review-card--apple')?.classList.remove('is-playing'); });
                }
                function formatTime(seconds) {
                    if (isNaN(seconds)) return "0:00";
                    const m = Math.floor(seconds / 60);
                    const s = Math.floor(seconds % 60);
                    return `${m}:${s < 10 ? '0' : ''}${s}`;
                }

            })();
        </script>


        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/08_Timeline_Mobile.html -->



        <div class="m-time-section">
            <div class="m-time-header">
                <h2 class="m-time-title">Тайминг</h2>
                <div class="m-time-sub">План наших приключений</div>
            </div>

            <!-- DAY 1 -->
            <div class="m-day-block">
                <div class="m-day-header">
                    <span class="m-day-icon">&#128197;</span> 13 Марта (Чт)
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">18:00</div>
                    <div class="m-t-desc"><strong>Выезд</strong>Сбор и отправление в Крконоше.</div>
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">21:00</div>
                    <div class="m-t-desc"><strong>Заселение</strong>Прибытие, знакомство.</div>
                </div>
            </div>

            <!-- DAY 2 -->
            <div class="m-day-block">
                <div class="m-day-header">
                    <span class="m-day-icon">&#128197;</span> 14 Марта (Пт)
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">Утро</div>
                    <div class="m-t-desc"><strong>Практики</strong>Йога, дыхание.</div>
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">День</div>
                    <div class="m-t-desc"><strong>Активность</strong>Лыжи, санки или прогулки.</div>
                </div>
            </div>

            <!-- DAY 3 -->
            <div class="m-day-block">
                <div class="m-day-header">
                    <span class="m-day-icon">&#128197;</span> 15 Марта (Сб)
                </div>

                <div class="m-t-item">
                    <div class="m-t-time">Утро</div>
                    <div class="m-t-desc"><strong>Йога</strong>Утренняя практика и завтрак.</div>
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">День</div>
                    <div class="m-t-desc"><strong>Релакс</strong>Звуковой массаж, свободное время.</div>
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">16:00</div>
                    <div class="m-t-desc"><strong>Домой</strong>Выезд в Прагу.</div>
                </div>
                <div class="m-t-item">
                    <div class="m-t-time">19:00</div>
                    <div class="m-t-desc"><strong>Прибытие</strong>Мы дома.</div>
                </div>
            </div>

        </div>

        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/09_OrgDetails_Mobile.html -->



        <div class="m-org-section">
            <div class="m-org-header">
                <h2 class="m-org-title">Стоимость:</h2>
            </div>

            <!-- Included -->
            <div class="m-info-card accent">
                <div class="m-info-h">
                    <span>Включено</span>
                    <div style="text-align:right;">
                        <span class="m-price-tag">5 699 KC</span>
                        <div style="font-size:10px; color:#888; margin-top:4px;">Early Bird цена</div>
                    </div>
                </div>
                <ul class="m-list">
                    <li class="check">Трансфер туда и обратно</li>
                    <li class="check">Проживание (3 дня)</li>
                    <li class="check">Йога и медитации</li>
                    <li class="check">Дыхательные практики</li>
                    <li class="check">Звуковой массаж чашами</li>
                    <li class="check">Вечерние программы</li>
                    <li class="check">Сопровождение организаторов</li>
                    <li class="check">Профессиональный фотоотчет</li>
                </ul>
            </div>

            <!-- Extra -->
            <div class="m-info-card">
                <div class="m-info-h">
                    <span>Не включено</span>
                </div>
                <ul class="m-list">
                    <li>Обеды и ужины</li>
                    <li>Личные расходы</li>
                </ul>
            </div>

            <!-- Clothing -->
            <div class="m-info-card">
                <div class="m-info-h">
                    <span>Что надеть?</span>
                </div>
                <p class="m-info-text">
                    Одевайся удобно и тепло! Идеально — непромокаемые штаны + куртка.
                    <br><br>
                    Обязательно: перчатки, шапка, шарф и удобная зимняя обувь.
                </p>
            </div>

            <div class="m-float-spacer"></div>
        </div>

        <button onclick="openWidget()" class="m-float-cta kover-btn" id="sticky-cta">
            Занять место
        </button>

        <script>
            window.addEventListener('scroll', () => {
                const btn = document.getElementById('sticky-cta');
                const ctaSection = document.querySelector('.m-cta-section');
                const scrollY = window.scrollY;

                // Show after scrolling a bit
                let shouldShow = scrollY > 400;

                // Hide if footer/final CTA is visible so they don't overlap
                if (ctaSection && shouldShow) {
                    const rect = ctaSection.getBoundingClientRect();
                    if (rect.top < window.innerHeight) {
                        shouldShow = false;
                    }
                }

                if (shouldShow) {
                    btn.classList.add('visible');
                } else {
                    btn.classList.remove('visible');
                }
            });
        </script>



        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/10_HowItWorks_Mobile.html -->



        <div class="m-how-section">
            <h2 class="m-how-title">Как это работает</h2>

            <div class="m-how-list">
                <!-- Customer Journey Mapping -->

                <!-- Step 1 -->
                <div class="m-how-item">
                    <div class="m-how-icon-box">
                        <!-- Credit Card Icon -->
                        <svg viewBox="0 0 24 24">
                            <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                            <line x1="2" y1="10" x2="22" y2="10"></line>
                        </svg>
                    </div>
                    <div class="m-how-content">
                        <h3>1. Забронируй</h3>
                        <p>Оплата картой (Apple Pay / Google Pay). Место закрепится за тобой моментально.</p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="m-how-item">
                    <div class="m-how-icon-box"
                        style="background: rgba(189, 255, 0, 0.1); color: #BDFF00; border-color: rgba(189, 255, 0, 0.2);">
                        <!-- Chat Icon -->
                        <svg viewBox="0 0 24 24">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                    <div class="m-how-content">
                        <h3>2. Вступай в чат</h3>
                        <p>Сразу после оплаты ты получишь ссылку на Telegram-чат тура. Там вся тусовка и организаторы.
                        </p>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="m-how-item">
                    <div class="m-how-icon-box"
                        style="background: rgba(255, 255, 255, 0.1); color: #fff; border-color: rgba(255, 255, 255, 0.2);">
                        <!-- Bus Icon -->
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" />
                            <circle cx="7" cy="17" r="2" />
                            <circle cx="17" cy="17" r="2" />
                            <path d="M5 17h2v-6h10v6h2" />
                        </svg>
                    </div>
                    <div class="m-how-content">
                        <h3>3. Погнали!</h3>
                        <p>В четверг в 18:00 встречаемся у автобуса. Загружаемся и мчим в Крконоше.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/11_Team_Mobile.html -->



        <div class="m-team-section">
            <div class="m-team-header">
                <h2 class="m-team-title">Мы про жизнь, а не просто локации</h2>

                <div class="m-tags-row">
                    <span class="m-tag accent">#koverfamily</span>
                    <span class="m-tag">#freedom</span>
                    <span class="m-tag">#emotions</span>
                </div>

                <div class="m-team-desc">
                    Мы — команда людей, у которых в крови движ. Kover Travel родился не в офисе, а в дороге.
                    <br><br>
                    Мы создаем трипы, где каждый день — это <span class="m-highlight">кайф и свобода</span>.
                    Всё по-настоящему: горы, скорость, смех и ощущение, что ты реально живёшь.
                </div>
            </div>

            <!-- Marquee -->
            <div class="m-marquee-wrap">
                <div class="m-marquee-track">
                    <!-- Set 1 -->
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild6639-3338-4839-b762-653938316663/DSCF7839-74.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild3639-3634-4235-b231-353239666166/KOVERStaff_ParisEtre.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild6163-3438-4331-b161-326264363835/DSCF6813.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild3232-3335-4534-b632-643439383466/IMG_3606_1.jpg"
                            class="m-team-img"></div>

                    <!-- Set 2 (Duplicate for loop) -->
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild6639-3338-4839-b762-653938316663/DSCF7839-74.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild3639-3634-4235-b231-353239666166/KOVERStaff_ParisEtre.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild6163-3438-4331-b161-326264363835/DSCF6813.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild3232-3335-4534-b632-643439383466/IMG_3606_1.jpg"
                            class="m-team-img"></div>

                    <!-- Set 3 (To be safe on wide screens) -->
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild6639-3338-4839-b762-653938316663/DSCF7839-74.jpg"
                            class="m-team-img"></div>
                    <div class="m-team-card"><img
                            src="https://static.tildacdn.com/tild3639-3634-4235-b231-353239666166/KOVERStaff_ParisEtre.jpg"
                            class="m-team-img"></div>
                </div>
            </div>

        </div>

        <!-- MOBILE SOURCE: Двухдневка в Альпы/Mobile_Version/10b_CTA_Mobile.html -->



        <div class="m-cta-section">
            <h2 class="m-cta-title">Готов к приключению?</h2>
            <p class="m-cta-sub">Места в автобусе разбирают быстро. Не откладывай жизнь на потом.</p>
            <a href="#widget" onclick="openWidget()" class="m-cta-btn kover-btn">Занять место</a>
        </div>
    </div><!-- END MOBILE -->

    <!-- SCRIPTS -->
    <!-- BLOCK 3: WIDGET & JS -->

    <!-- WIDGET SOURCE: Двухдневка в Альпы/Widget_Config.html -->

    <!-- 
    BLOCK: ADMIN CONFIGURATION (T123)
    ОПИСАНИЕ: Этот блок должен стоять ВЫШЕ (или ПЕРЕД) основным блоком виджета.
    Здесь задаются настройки конкретного тура.
-->
    <script>
        window.KOVER_WIDGET_CONFIG = {
            // --- ОСНОВНЫЕ НАСТРОЙКИ ---
            id: 'krkonose_13_03_26',                // ID тура
            name: 'Ретрит в Крконоше 13-15.03.2026',// Название тура
            date: '13.03.2026',                    // Дата тура (ДД.ММ.ГГГГ)
            tourType: 'Многодневный',              // Тип тура (Однодневный/Многодневный)

            // --- ЦЕНЫ ---
            price: 5699,                           // Полная стоимость
            deposit: 2000,                         // Размер залога

            // --- ССЫЛКИ И КЛЮЧИ ---
            // Однодневные: pk_live_51SE6PPDcw9kAY89HfWvBpSfQqQ4BvbF5D9cEOkQ1DC5YNK5HARwuhhWZzTEQA6WCoATixBmkEJ8eTbpVUyw96wK0001cNUyYD6 
            // Многодневные: pk_live_51QZA0yP0YuqgKgjw407FXR13mJwf39jkzsU3LU5PFMxpw1D1qsn0nTKmWSdtc4vCLAzHZuFcQ2SQAvcYNe8OSQiA00Qn5abpJQ
            stripeKey: 'pk_live_51QZA0yP0YuqgKgjw407FXR13mJwf39jkzsU3LU5PFMxpw1D1qsn0nTKmWSdtc4vCLAzHZuFcQ2SQAvcYNe8OSQiA00Qn5abpJQ',
            webhook: 'https://hook.eu2.make.com/t118j4fcirfp3s6srdt97ahsr9hggo63',
            telegram_link: 'https://t.me/+Qdrdej9s6g03NmUy' // Ссылка на чат/канал
        };
    </script>

    <!-- WIDGET SOURCE: Двухдневка в Альпы/Widget_Core.html -->



    <!-- Admin Config removed. Use external T123 block with window.KOVER_WIDGET_CONFIG -->

    <!-- Hidden trigger, logic handled via #book-now hash -->
    <button class="open-modal-btn" onclick="openWidget()">Забронировать место</button>

    <div class="modal-overlay" id="widget-overlay">
        <div class="widget-container" id="widget-card">

            <!-- HEADER -->
            <div class="widget-header">
                <div class="stepper" id="stepper">
                    <div class="step-item active" id="step-ind-1">
                        <div class="step-circle">1</div>
                        <span>Параметры</span>
                    </div>
                    <div class="step-item" id="step-ind-2">
                        <div class="step-circle">2</div>
                        <span>Участники</span>
                    </div>
                    <div class="step-item" id="step-ind-3">
                        <div class="step-circle">3</div>
                        <span>Оплата</span>
                    </div>
                </div>
                <div class="close-btn" onclick="closeWidget()">✕</div>
            </div>

            <!-- BODY: SCROLLABLE CONTENT -->
            <div class="widget-body" id="widget-body">

                <!-- STEP 1: CONFIG -->
                <div class="step-slide active" id="slide-1">
                    <h2>Параметры поездки</h2>

                    <div style="margin-bottom: 24px;">
                        <div class="plan-card selected" id="opt-full" onclick="selectPlan('full')">
                            <div style="display:flex; align-items:flex-start;">
                                <div class="radio-circle"></div>
                                <div>
                                    <div style="font-weight:600; font-size:16px; margin-bottom: 2px;">Оплатить полностью
                                    </div>
                                    <div style="font-size:13px; color:#86868b;">Без доплат в будущем</div>
                                </div>
                            </div>
                            <div style="font-weight:700; font-size:16px;" id="price-full-display">...</div>
                        </div>

                        <div class="plan-card" id="opt-deposit" onclick="selectPlan('deposit')">
                            <div style="display:flex; align-items:flex-start;">
                                <div class="radio-circle"></div>
                                <div>
                                    <div style="font-weight:600; font-size:16px; margin-bottom: 2px;">Внести залог</div>
                                    <div style="font-size:13px; color:#86868b;">Остаток <span id="remain-val">...</span>
                                        позже</div>
                                </div>
                            </div>
                            <div style="font-weight:700; font-size:16px;" id="price-depo-display">...</div>
                        </div>
                    </div>

                    <div class="counter-row">
                        <span class="counter-label">Количество участников</span>
                        <div class="counter-ctrl">
                            <div class="c-btn" onclick="updateCount(-1)">–</div>
                            <div class="c-val" id="count-val">1</div>
                            <div class="c-btn" onclick="updateCount(1)">+</div>
                        </div>
                    </div>

                    <div style="margin-top:20px; font-size:14px; color:#86868b; text-align:center;">
                        Общая стоимость: <span id="summ-total" style="font-weight:700; color:#1d1d1f;">...</span>
                    </div>
                </div>

                <!-- STEP 2: PASSENGERS -->
                <div class="step-slide" id="slide-2">
                    <h2>Участники</h2>
                    <div id="passengers-container"></div>

                    <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e5e5ea;">
                        <div style="display:flex; gap:10px; align-items:flex-start;">
                            <input type="checkbox" id="consent-chk"
                                style="margin-top:4px; transform:scale(1.2); accent-color:var(--color-accent);">
                            <label for="consent-chk" style="font-size:13px; color:#666; line-height:1.4;">
                                Я принимаю <a href="#"
                                    onclick="event.preventDefault(); document.getElementById('terms-popup').classList.add('active');"
                                    style="color:#007aff; text-decoration:none; border-bottom:1px solid rgba(0,122,255,0.3);">условия</a>
                                и политику обработки персональных данных
                            </label>
                        </div>
                    </div>
                </div>

                <!-- STEP 3: PAYMENT -->
                <div class="step-slide" id="slide-3" style="display:flex; flex-direction:column; height:100%;">
                    <h2>Оплата</h2>

                    <!-- LOADING OVERLAY -->
                    <div id="payment-loader" class="visible">
                        <div class="vibey-loader"></div>
                        <div style="font-size:18px; font-weight:600; color:#1d1d1f; margin-bottom: 8px;">Загружаем
                            магию...</div>
                        <div style="font-size:14px; color:#86868b;">Секундочку, всё готовим для вас</div>
                    </div>

                    <div id="stripe-mount-point" style="flex:1; display:flex; flex-direction:column;">

                        <!-- WALLET SECTION -->
                        <div id="wallet-container" style="display:none; margin-bottom: 24px;">
                            <div id="wallet-element" style="height: 48px;"></div>
                            <div style="display:flex; align-items:center; margin: 20px 0;">
                                <div style="flex:1; height:1px; background:#e5e5ea;"></div>
                                <div style="padding:0 10px; font-size:13px; color:#86868b; font-weight:500;">ИЛИ КАРТОЙ
                                </div>
                                <div style="flex:1; height:1px; background:#e5e5ea;"></div>
                            </div>
                        </div>

                        <!-- CARD SECTION -->
                        <div class="form-group" style="margin-bottom:24px;">
                            <div class="form-label" style="margin-left:4px;">БАНКОВСКАЯ КАРТА</div>
                            <div id="card-element" class="stripe-box" style="padding: 12px 16px;">
                                <!-- Stripe Element injects here -->
                            </div>
                            <div id="payment-message" style="
                                margin-top: 12px; 
                                padding: 12px; 
                                background: #fff0f0; 
                                color: var(--color-error); 
                                font-size: 13px; 
                                border-radius: 12px; 
                                display: none;
                                line-height: 1.4;
                            "></div>
                        </div>

                        <!-- SUMMARY CARD -->
                        <div style="background:#f2f2f7; border-radius:16px; padding:16px; margin-bottom:20px;">
                            <div
                                style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:14px; color:#666;">
                                <span>К оплате сейчас</span>
                                <span style="font-weight:600; color:#000;" id="pay-now-val">...</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:13px; color:#86868b;">
                                <span>Тип оплаты</span>
                                <span id="payment-type-label">...</span>
                            </div>
                        </div>

                        <!-- SECURE BADGE (Bottom) -->
                        <div style="margin-top:auto; text-align:center; padding-top:20px; padding-bottom:10px;">
                            <div style="display:inline-flex; align-items:center; gap:6px; opacity:0.6;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#666"
                                    stroke-width="2.5">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                                <span style="font-size:11px; color:#666; font-weight:500;">Платежи защищены
                                    Stripe</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SUCCESS STATE -->
                <div class="step-slide" id="slide-success">
                    <div style="text-align:center; padding: 20px 20px 40px 20px;">
                        <div style="font-size:60px; color:#34c759; margin-bottom:20px;">✓</div>
                        <h2>Оплата прошла успешно!</h2>
                        <p style="color:#666; margin-bottom:24px; line-height:1.5;">
                            Мы отправили подтверждение на <span id="success-email"
                                style="font-weight:600; color:#000;"></span>.
                        </p>
                        <div id="success-message-dynamic"
                            style="font-size:15px; color:#1d1d1f; line-height:1.6; margin-bottom: 24px;"></div>

                        <a href="#" target="_blank" id="tg-join-btn" class="btn-primary"
                            style="text-decoration:none; display:flex; align-items:center; justify-content:center; background-color:#2AABEE; margin-bottom:12px;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg" style="margin-right:8px;">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-0.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.48-1.02-2.4-1.63-1.06-.7-0.37-1.09 0.23-1.72 0.16-.16 2.87-2.63 2.93-2.85 0.01-.03 0.01-.15-.06-.21-.07-.06-.18-.04-.26-.02-.11.02-1.92 1.22-5.43 3.59-.51.35-.98.52-1.39.51-.46-.01-1.33-.26-1.98-.47-.8-.26-1.43-.4-1.37-.84.03-.23.35-.46.96-.71 3.77-1.64 6.28-2.72 7.53-3.24 3.58-1.48 4.32-1.74 3.8-1.74z"
                                    fill="white" />
                            </svg>
                            Вступить в чат поездки
                        </a>
                    </div>
                </div>

            </div>

            <!-- FOOTER: ACTIONS -->
            <div class="widget-footer" id="widget-footer">
                <button class="btn-primary" id="btn-next-action" onclick="handleNextClick()">Продолжить</button>
                <button class="btn-secondary" id="btn-back-action" onclick="handleBackClick()"
                    style="display:none;">Назад</button>
            </div>
        </div>
    </div>

    <!-- TERMS POPUP -->
    <div class="modal-overlay" id="terms-popup" style="z-index: 10001;">
        <div class="widget-container" style="height: 80%; max-height: 600px;">
            <div class="widget-header">
                <h3 style="margin:0; font-size:18px;">Условия</h3>
                <div class="close-btn" onclick="document.getElementById('terms-popup').classList.remove('active')">✕
                </div>
            </div>
            <div class="widget-body" style="padding: 24px; overflow-y: auto;">
                <h4 style="margin-top:0; margin-bottom:12px;">Souhlas se zpracováním osobních údajů (GDPR)</h4>
                <p style="font-size:13px; color:#333; line-height:1.6;">
                    V souladu s Nařízením Evropského parlamentu a Rady (EU) 2016/679 o ochraně fyzických osob v
                    souvislosti se zpracováním osobních údajů a o volném pohybu těchto údajů (dále jen "GDPR")
                    potvrzuji, že jsem se seznámil(a) s podmínkami zpracování osobních údajů.
                </p>
                <p style="font-size:13px; color:#333; line-height:1.6;">
                    <strong>1. Správce údajů:</strong> Kover Travel<br>
                    <strong>2. Účel zpracování:</strong> Osobní údaje (jméno, příjmení, datum narození, e-mail, telefon)
                    jsou shromažďovány a zpracovávány výhradně za účelem poskytování služeb cestovního ruchu, vyřízení
                    rezervace, komunikace s klientem a plnění zákonných povinností.<br>
                    <strong>3. Doba uchování:</strong> Údaje budou uchovávány po dobu nezbytně nutnou k plnění účelu
                    smlouvy a dle zákonných lhůt.<br>
                    <strong>4. Vaše práva:</strong> Máte právo na přístup k údajům, jejich opravu, výmaz ("právo být
                    zapomenut"), omezení zpracování a právo vznést námitku.
                </p>
                <p style="font-size:13px; color:#666;">
                    Vaše údaje nejsou bez vašeho souhlasu předávány třetím stranám, s výjimkou partnerů nezbytných pro
                    realizaci služby (např. ubytovací zařízení, dopravci, pojišťovny).
                </p>
                <button class="btn-primary" onclick="document.getElementById('terms-popup').classList.remove('active')"
                    style="margin-top:20px;">Rozumím / Zavřít</button>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js"></script>

    <script>
        // --- CONFIG (DEFAULTS) ---
        let CONFIG = {
            id: 'default_tour',
            name: 'Default Tour',
            date: '01.01.2025',
            price: 100, // Non-zero default for Apple Pay testing
            deposit: 100,
            stripeKey: 'pk_live_51SE6PPDcw9kAY89HfWvBpSfQqQ4BvbF5D9cEOkQ1DC5YNK5HARwuhhWZzTEQA6WCoATixBmkEJ8eTbpVUyw96wK0001cNUyYD6',
            webhook: '',
            tourType: 'Tour',
            telegram_link: ''
        };

        // --- STATE ---
        let state = {
            step: 1,
            count: 1,
            plan: 'full', // 'full' | 'deposit'
            passengers: [],
            contact: { email: '', phone: '' },
            clientSecret: null // Store secret securely here
        };

        let paymentIntentPromise = null;

        function invalidatePaymentIntent() {
            state.clientSecret = null;
            paymentIntentPromise = null;
        }

        let stripe, elements, cardElement, prButton;
        let iti;

        // --- INIT ---
        function initWidgetCore() {
            // 1. Try to load config from window (in case it was loaded later)
            if (window.KOVER_WIDGET_CONFIG) {
                CONFIG = { ...CONFIG, ...window.KOVER_WIDGET_CONFIG };
            }

            // Set prices
            const pFull = document.getElementById('price-full-display');
            if (pFull) pFull.innerText = CONFIG.price + " Kč";
            const pDepo = document.getElementById('price-depo-display');
            if (pDepo) pDepo.innerText = CONFIG.deposit + " Kč";
            const pRem = document.getElementById('remain-val');
            if (pRem) {
                const parts = CONFIG.date.split('.');
                const tDate = new Date(parts[2], parts[1] - 1, parts[0]);

                // --- 12 DAYS CHECK ---
                const now = new Date();
                const diffTime = tDate - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays < 12) {
                    // Less than 12 days: Hide Deposit Option entirely
                    const depoOpt = document.getElementById('opt-deposit');
                    if (depoOpt) {
                        depoOpt.style.display = 'none';
                    }
                    // Force full plan if deposit was somehow default or selected
                    state.plan = 'full';
                    document.getElementById('opt-full').classList.add('selected');
                    // Also maybe change label of full option?
                }

                // Balance due date logic (existing)
                tDate.setDate(tDate.getDate() - 10);
                const dStr = String(tDate.getDate()).padStart(2, '0') + '.' + String(tDate.getMonth() + 1).padStart(2, '0') + '.' + tDate.getFullYear();
                pRem.parentElement.innerHTML = `Остаток <span style="color:#007aff; font-weight:700;">${(CONFIG.price - CONFIG.deposit)} Kč</span> до ${dStr}`;
            }

            updateSummary();
            // Check if Stripe is loaded
            if (typeof Stripe !== 'undefined') {
                stripe = Stripe(CONFIG.stripeKey);
            } else {
                console.error('Stripe JS not loaded yet');
            }


            // Hash Trigger Check
            checkHash();
            window.addEventListener('hashchange', checkHash);

            // Link Trigger Check
            document.body.addEventListener('click', (e) => {
                const link = e.target.closest('a');
                if (link && link.getAttribute('href') === '#book-now') {
                    e.preventDefault();
                    openWidget();
                }
            });

            // --- STRIPE RETURN HANDLING ---
            const urlParams = new URLSearchParams(window.location.search);
            const redirectStatus = urlParams.get('redirect_status');
            const clientSecret = urlParams.get('payment_intent_client_secret');

            if (redirectStatus && clientSecret) {
                // Restore state to get email/passenger data back
                loadStateFromStorage();

                // Open widget immediately
                document.getElementById('widget-overlay').classList.add('active');
                document.body.style.overflow = 'hidden';

                if (redirectStatus === 'succeeded') {
                    // Go to success
                    goToStep(4, true);
                    // Clear storage
                    sessionStorage.removeItem('kover_widget_state');
                } else {
                    // Failed
                    goToStep(3, true);
                    const msg = document.getElementById('payment-message');
                    if (msg) {
                        msg.innerText = "Оплата не была завершена. Попробуйте снова.";
                        msg.style.display = 'block';
                    }
                }
            }
        }

        // Execute Init
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initWidgetCore);
        } else {
            initWidgetCore();
        }

        // --- STORAGE HELPERS ---
        function saveStateToStorage() {
            try {
                sessionStorage.setItem('kover_widget_state', JSON.stringify(state));
            } catch (e) { console.error('Save state error', e); }
        }

        function loadStateFromStorage() {
            try {
                const s = sessionStorage.getItem('kover_widget_state');
                if (s) {
                    const parsed = JSON.parse(s);
                    // Merge safely
                    state = { ...state, ...parsed };
                    // Restore inputs if needed? 
                    // Since we jump to Step 4 (Success) or Step 3 (Payment), we might not need to re-fill Step 1/2 inputs visually 
                    // unless user goes "Back". 
                    // Ideally we should re-populate if they go back. 
                    // But 'state' object is the source of truth for rendering.
                    // If we go to Step 3, initPayment uses state object.
                    // If we go back to Step 2, renderPassengers uses state object. 
                    // So we are good!
                }
            } catch (e) { console.error('Load state error', e); }
        }

        function checkHash() {
            if (window.location.hash === '#book-now') {
                openWidget();
            }
        }

        // --- NAVIGATION CONTROLLER ---
        async function goToStep(step, force = false) {
            if (step === state.step && !force) return;
            const direction = step > state.step ? 'next' : 'prev';

            // Logic: Destroy Stripe if leaving step 3
            if (state.step === 3 && step !== 3) {
                destroyStripe();
            }

            // PRE-RENDER content before animation starts
            if (step === 2) {
                renderPassengers();
                // preloadPaymentData(); removed to ensure we send full data later
            }

            // Update UI State (Slides)
            const currentSlide = document.getElementById(state.step === 4 ? 'slide-success' : `slide-${state.step}`);
            const nextSlide = document.getElementById(step === 4 ? 'slide-success' : `slide-${step}`);

            document.querySelectorAll('.step-slide').forEach(s => {
                s.classList.remove('active', 'slide-enter-next', 'slide-exit-next', 'slide-enter-prev', 'slide-exit-prev');
                if (s !== currentSlide && s !== nextSlide) s.style.display = 'none';
            });

            if (force) {
                nextSlide.classList.add('active');
                nextSlide.style.display = 'block';
            } else {
                currentSlide.classList.add('active');
                nextSlide.classList.add('active');
                nextSlide.style.display = 'block';

                if (direction === 'next') {
                    currentSlide.classList.add('slide-exit-next');
                    nextSlide.classList.add('slide-enter-next');
                } else {
                    currentSlide.classList.add('slide-exit-prev');
                    nextSlide.classList.add('slide-enter-prev');
                }

                setTimeout(() => {
                    currentSlide.classList.remove('active', 'slide-exit-next', 'slide-exit-prev');
                    nextSlide.classList.remove('slide-enter-next', 'slide-enter-prev'); // cleanup
                    currentSlide.style.display = 'none';
                    nextSlide.classList.add('active');
                    // Reset scroll
                    const slide = nextSlide;
                    if (slide) slide.scrollTop = 0;
                }, 380);
            }

            state.step = step;

            // Initialize Payment AFTER slide is visible (Crucial for Apple Pay)
            if (step === 3) initPayment();

            if (step === 4) {
                // Update Telegram Link from CONFIG
                const tgBtn = document.getElementById('tg-join-btn');
                if (tgBtn && CONFIG.telegram_link) {
                    tgBtn.href = CONFIG.telegram_link;
                }

                const msgEl = document.getElementById('success-message-dynamic');
                if (msgEl) {
                    if (state.plan === 'deposit') {
                        msgEl.innerHTML = `В письме вы также найдете ссылку для <strong>доплаты остатка</strong>.`;
                    } else {
                        msgEl.innerHTML = `В письме вы найдете ссылку на вступление в Telegram-чат участников.`;
                    }
                }
            }

            updateFooterAndStepper();
        }

        function updateFooterAndStepper() {
            // Stepper
            if (state.step < 4) {
                document.getElementById('stepper').style.visibility = 'visible';
                for (let i = 1; i <= 3; i++) {
                    const el = document.getElementById(`step-ind-${i}`);
                    if (i === state.step) {
                        el.classList.add('active');
                        el.classList.remove('completed');
                        el.querySelector('.step-circle').innerText = i;
                    } else if (i < state.step) {
                        el.classList.remove('active');
                        el.classList.add('completed');
                        el.querySelector('.step-circle').innerText = '✓';
                    } else {
                        el.classList.remove('active', 'completed');
                        el.querySelector('.step-circle').innerText = i;
                    }
                }
            } else {
                document.getElementById('stepper').style.visibility = 'hidden';
            }

            // Footer Buttons
            const btnNext = document.getElementById('btn-next-action');
            const btnBack = document.getElementById('btn-back-action');

            if (state.step === 1) {
                btnNext.innerText = 'Продолжить';
                btnBack.style.display = 'none';
            } else if (state.step === 2) {
                btnNext.innerText = 'Перейти к оплате';
                btnBack.style.display = 'block';
                btnBack.innerText = 'Назад к параметрам';
            } else if (state.step === 3) {
                const price = state.plan === 'full' ? CONFIG.price : CONFIG.deposit;
                const total = price * state.count;
                // Button text dynamically set
                btnNext.innerText = `Оплатить ${total} Kč`;
                btnBack.style.display = 'block';
                btnBack.innerText = 'Назад к вводу данных';
            } else if (state.step === 4) {
                btnNext.innerText = 'Закрыть';
                btnBack.style.display = 'none';
            }

            btnNext.disabled = false;
        }

        function handleNextClick() {
            if (state.step === 1) {
                goToStep(2);
            } else if (state.step === 2) {
                if (validateStep2()) {
                    invalidatePaymentIntent(); // Force fresh data send
                    goToStep(3);
                }
            } else if (state.step === 3) {
                confirmPayment();
            } else if (state.step === 4) {
                closeWidget(); // Close on success
            }
        }

        function handleBackClick() {
            if (state.step === 2) goToStep(1);
            else if (state.step === 3) goToStep(2);
        }

        function openWidget() {
            document.getElementById('widget-overlay').classList.add('active');
            document.body.style.overflow = 'hidden';
            goToStep(1, true);
        }

        function closeWidget() {
            if (state.step === 4) {
                // Reset if closed after success
                setTimeout(() => { goToStep(1, true); }, 500);
            }
            document.getElementById('widget-overlay').classList.remove('active');
            document.body.style.overflow = '';
            // Remove hash if present so it can be re-triggered
            setTimeout(() => {
                if (window.location.hash === '#book-now') {
                    history.pushState("", document.title, window.location.pathname + window.location.search);
                }
            }, 100);
            setTimeout(destroyStripe, 300);
        }

        // --- STEP 1 LOGIC ---
        function selectPlan(plan) {
            state.plan = plan;
            invalidatePaymentIntent();
            document.getElementById('opt-full').classList.toggle('selected', plan === 'full');
            document.getElementById('opt-deposit').classList.toggle('selected', plan === 'deposit');
            updateSummary();
        }

        function updateCount(delta) {
            const n = state.count + delta;
            if (n >= 1 && n <= 10) {
                state.count = n;
                invalidatePaymentIntent();
                document.getElementById('count-val').innerText = n;
                updateSummary();
            }
        }

        function updateSummary() {
            const price = state.plan === 'full' ? CONFIG.price : CONFIG.deposit;
            const total = price * state.count;
            document.getElementById('summ-total').innerText = `${total} Kč`;
        }

        // --- STEP 2 LOGIC ---
        function renderPassengers() {
            const container = document.getElementById('passengers-container');
            container.innerHTML = '';

            for (let i = 0; i < state.count; i++) {
                const p = state.passengers[i] || { name: '', surname: '', dob: '' };
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <div style="font-weight:700; margin-bottom:12px; margin-top:24px;">Участник ${i + 1}</div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                        <input class="inp-field p-name" id="p-name-${i}" data-idx="${i}" placeholder="Имя (Latin)" value="${p.name}" autocomplete="given-name">
                        <input class="inp-field p-surname" id="p-surname-${i}" data-idx="${i}" placeholder="Фамилия" value="${p.surname}" autocomplete="family-name">
                    </div>
                     <!-- Hidden error containers -->
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                        <input type="hidden" class="err-name-dummy"> 
                        <div class="input-error-msg err-name" style="grid-column: 1;">Только латиница</div>
                        <div class="input-error-msg err-surname" style="grid-column: 2;">Только латиница</div>
                    </div>

                    <!-- FLATPICKR INPUT -->
                    <input class="inp-field p-dob" id="p-dob-${i}" data-idx="${i}" 
                           placeholder="Дата рождения (ДД.ММ.ГГГГ)" value="${p.dob}" 
                           style="margin-top:24px;" autocomplete="bday">
                    
                    <div class="input-error-msg err-dob-format">Введите дату</div>
                    <div class="input-error-msg err-dob-age" style="color: #ff9500; display: none;">
                        Действуют возрастные ограничения на детей до 7 лет, пожалуйста, свяжитесь с нами в инстаграм
                    </div>
                `;
                container.appendChild(div);
            }

            const contactDiv = document.createElement('div');
            contactDiv.style.borderTop = '1px solid #e5e5ea';
            contactDiv.style.paddingTop = '16px';
            contactDiv.style.marginTop = '24px';
            contactDiv.innerHTML = `
                <div class="form-label" style="font-weight:600; color:#000;">Контактные данные</div>
                <div class="form-group">
                    <input type="email" id="inp-email" class="inp-field" placeholder="Email" value="${state.contact.email}" autocomplete="email">
                    <div class="input-error-msg">Некорректный Email</div>
                </div>
                <div class="form-group">
                    <input type="tel" id="inp-phone" class="inp-field" value="${state.contact.phone}" autocomplete="tel">
                    <div class="input-error-msg">Некорректный номер</div>
                </div>
            `;
            container.appendChild(contactDiv);

            // --- LISTENERS ---

            // Name/Surname Logic
            const setupTextInputs = (selector, nextSelector) => {
                container.querySelectorAll(selector).forEach((inp, idx) => {
                    inp.addEventListener('input', (e) => {
                        const isName = selector.includes('name');
                        const errSel = isName ? '.err-name' : '.err-surname';
                        // Validation
                        const err = inp.parentElement.nextElementSibling.querySelector(errSel);
                        if (/[^a-zA-Z\s-]/.test(inp.value)) {
                            inp.classList.add('error');
                            if (err) err.style.display = 'block';
                        } else {
                            inp.classList.remove('error');
                            if (err) err.style.display = 'none';
                        }
                        saveState2();
                    });

                    inp.addEventListener('blur', (e) => {
                        capitalize(e.target);
                        saveState2();
                    });

                    // Auto-Jump on Enter
                    inp.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            const next = document.getElementById(nextSelector.replace('${i}', idx));
                            if (next) next.focus();
                        }
                    });
                });
            };

            setupTextInputs('.p-name', 'p-surname-${i}');
            setupTextInputs('.p-surname', 'p-dob-${i}');

            // FLATPICKR INIT
            container.querySelectorAll('.p-dob').forEach((inp) => {
                if (typeof flatpickr !== 'undefined') {
                    const idx = inp.getAttribute('data-idx');
                    const pVal = state.passengers[idx] ? state.passengers[idx].dob : '';

                    flatpickr(inp, {
                        locale: "ru",
                        dateFormat: "d.m.Y",
                        disableMobile: true,
                        allowInput: true,
                        defaultDate: pVal || undefined, // Keep empty if no value
                        onOpen: function (selectedDates, dateStr, instance) {
                            if (selectedDates.length === 0) {
                                instance.jumpToDate("01.01.2000"); // Jump to 2000 view without setting value
                            }
                        },
                        onClose: function (selectedDates, dateStr, instance) {
                            checkAge(instance.element);
                            saveState2();
                        }
                    });
                }

                inp.addEventListener('blur', (e) => { checkAge(e.target); saveState2(); });
                inp.addEventListener('input', (e) => { saveState2(); });
            });

            // Phone
            const phoneEl = document.getElementById('inp-phone');
            if (iti) iti.destroy();
            iti = window.intlTelInput(phoneEl, {
                utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js",
                initialCountry: "cz",
                preferredCountries: ["cz", "ua", "ru"],
                autoPlaceholder: "aggressive",
                separateDialCode: true
            });

            // Logic to strip country code if autofilled (e.g. +420)
            const cleanPhoneInput = () => {
                const data = iti.getSelectedCountryData();
                const dialCode = data.dialCode;
                let val = phoneEl.value;
                // Check for +Code prefix (e.g. +420)
                if (val.startsWith('+' + dialCode)) {
                    phoneEl.value = val.substring(dialCode.length + 1).trim();
                }
            };

            phoneEl.addEventListener('input', () => {
                cleanPhoneInput();
                saveState2();
            });

            phoneEl.addEventListener('blur', () => {
                cleanPhoneInput();
                if (!iti.isValidNumber()) {
                    phoneEl.classList.add('error');
                } else {
                    phoneEl.classList.remove('error');
                    // Smooth scroll to consent
                    const chk = document.getElementById('consent-chk');
                    if (chk) {
                        chk.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }

                    // PRELOAD PAYMENT DATA NOW to avoid Apple Pay race conditions
                    // Capture current inputs to state so payload is valid
                    saveState2();
                    if (state && state.contact) state.contact.phone = iti.getNumber(); // Ensure full number
                    // preloadPaymentData(); removed
                }
                saveState2();
            });

            // Email
            document.getElementById('inp-email').addEventListener('blur', (e) => {
                const val = e.target.value;
                if (val && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val)) e.target.classList.add('error');
                else e.target.classList.remove('error');
                saveState2();
            });
        }

        function checkAge(el) {
            const val = el.value;
            const ageMsg = el.nextElementSibling.nextElementSibling; // .err-dob-age
            const fmtMsg = el.nextElementSibling; // .err-dob-format

            // Basic parsing DD.MM.YYYY
            if (!val || val.length < 10) {
                // If typed partially, don't show error yet unless blurred?
                return false;
            }

            const parts = val.split('.');
            if (parts.length < 3) return false;

            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10);
            const year = parseInt(parts[2], 10);

            const dob = new Date(year, month - 1, day);
            const now = new Date();

            if (dob.getFullYear() === year && dob.getMonth() === month - 1 && dob.getDate() === day) {
                el.classList.remove('error');
                fmtMsg.style.display = 'none';

                // Age Logic
                let age = now.getFullYear() - dob.getFullYear();
                const m = now.getMonth() - dob.getMonth();
                if (m < 0 || (m === 0 && now.getDate() < dob.getDate())) {
                    age--;
                }

                if (age < 7) {
                    ageMsg.style.display = 'block';
                    el.classList.add('error');
                    return false; // Invalid age
                } else {
                    ageMsg.style.display = 'none';
                    el.classList.remove('error');
                    return true;
                }
            } else {
                // Invalid date format
                // Don't error aggressively while typing, but if full length exists:
                if (val.length >= 10) {
                    el.classList.add('error');
                    fmtMsg.style.display = 'block';
                }
                return false;
            }
        }

        function capitalize(el) {
            if (el.value) el.value = el.value.charAt(0).toUpperCase() + el.value.slice(1);
        }

        function saveState2() {
            state.passengers = [];
            document.querySelectorAll('.p-name').forEach((el, i) => {
                const s = document.getElementById(`p-surname-${i}`);
                const d = document.getElementById(`p-dob-${i}`);
                state.passengers[i] = {
                    name: el.value,
                    surname: s ? s.value : '',
                    dob: d ? d.value : ''
                };
            });
            const em = document.getElementById('inp-email');
            if (em) state.contact.email = em.value;
            if (iti) state.contact.phone = iti.getNumber();
        }

        function validateStep2() {
            saveState2();
            let isValid = true;
            const err = (el) => { el.classList.add('error'); el.classList.add('shake'); setTimeout(() => el.classList.remove('shake'), 400); isValid = false; };

            // Check Passengers
            document.querySelectorAll('.p-name').forEach(el => { if (el.value.length < 2 || /[^a-zA-Z\s-]/.test(el.value)) err(el); else el.classList.remove('error'); });
            document.querySelectorAll('.p-surname').forEach(el => { if (el.value.length < 2 || /[^a-zA-Z\s-]/.test(el.value)) err(el); else el.classList.remove('error'); });

            // DOB Check
            document.querySelectorAll('.p-dob').forEach(el => {
                // If empty or invalid age
                if (!checkAge(el)) {
                    // Check if empty
                    if (!el.value) {
                        el.classList.add('error');
                        el.nextElementSibling.style.display = 'block';
                    }
                    err(el);
                }
            });

            // Check Email
            const emailEl = document.getElementById('inp-email');
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailEl.value)) err(emailEl); else emailEl.classList.remove('error');

            // Check Phone
            const phoneEl = document.getElementById('inp-phone');
            if (!iti.isValidNumber()) err(phoneEl); else phoneEl.classList.remove('error');

            // Check content
            const chk = document.getElementById('consent-chk');
            if (!chk.checked) { chk.parentElement.style.color = 'red'; isValid = false; } else chk.parentElement.style.color = '';

            return isValid;
        }

        // --- STEP 3 LOGIC (PAYMENT) ---

        function buildPaymentPayload(price, total) {
            let paxSummary = [];
            state.passengers.forEach(p => paxSummary.push(`${p.name} ${p.surname}`));

            const payload = {
                order_id: `${CONFIG.id}_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
                timestamp: new Date().toISOString(),
                device_type: "Experimental Widget",
                browser_userAgent: navigator.userAgent,
                browser_language: navigator.language || navigator.userLanguage,
                browser_platform: navigator.platform,
                screen_resolution: `${window.screen.width}x${window.screen.height}`,
                viewport_size: `${window.innerWidth}x${window.innerHeight}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                referrer: document.referrer || "Direct",
                page_url: window.location.href,
                connection_type: navigator.connection ? navigator.connection.effectiveType : 'unknown',
                tour_name: CONFIG.name,
                tour_date: CONFIG.date,
                passengers: paxSummary.join(', '),
                contact_name: state.contact.name,
                contact_email: state.contact.email,
                contact_phone: state.contact.phone,
                count: state.count,
                plan: state.plan,
                tour_id: CONFIG.id,
                tour_type: CONFIG.tourType,
                passenger_count: state.count,
                selected_seats: "Без выбора мест",
                payment_type: state.plan === 'full' ? 'Полная оплата' : 'Залог',
                currency: "CZK",
                locale: "ru",
                buyer_phone: state.contact.phone,
                widget_open_method: window.location.hash === '#book-now' ? 'Hash Trigger' : 'Button Click',
                passengers_json_dump: JSON.stringify(state.passengers),
                total_pay_now: total,
                total_order_value: CONFIG.price * state.count,
                remaining_balance: state.plan === 'full' ? 0 : (CONFIG.price - CONFIG.deposit) * state.count,
                seats_surcharge: 0,
                buyer_email: state.contact.email,
                productName: CONFIG.name,
                all_passengers_summary: paxSummary.join(', '),
                telegram_link: CONFIG.telegram_link
            };

            state.passengers.forEach((p, i) => {
                payload[`passenger_${i + 1}_firstname`] = p.name;
                payload[`passenger_${i + 1}_lastname`] = p.surname;
                payload[`passenger_${i + 1}_name`] = `${p.name} ${p.surname}`;
                payload[`passenger_${i + 1}_dob`] = p.dob;
            });

            return payload;
        }

        function preloadPaymentData() {
            if (state.clientSecret || paymentIntentPromise) return;

            const price = state.plan === 'full' ? CONFIG.price : CONFIG.deposit;
            const total = price * state.count;
            const payload = buildPaymentPayload(price, total);

            console.log("Preloading payment data...");
            paymentIntentPromise = fetch(CONFIG.webhook, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
                .then(r => r.json())
                .catch(e => {
                    console.warn("Preload failed", e);
                    return null;
                });
        }

        async function initPayment() {

            // 1. Force Loader Visible IMMEDIATELY
            const loader = document.getElementById('payment-loader');
            loader.classList.add('visible');
            loader.style.opacity = '1';

            // 2. Prepare visual details behind loader
            const price = state.plan === 'full' ? CONFIG.price : CONFIG.deposit;
            const total = price * state.count;

            const payNowEl = document.getElementById('pay-now-val');
            if (payNowEl) payNowEl.innerText = total + " Kč";

            const typeLabel = document.getElementById('payment-type-label');
            if (typeLabel) typeLabel.innerText = state.plan === 'full' ? "Полная оплата" : "Залог";

            // 3. Elements Initialization 
            if (!elements) {
                try {
                    let data;
                    if (state.clientSecret) {
                        data = { clientSecret: state.clientSecret };
                    } else {
                        if (!paymentIntentPromise) {
                            const payload = buildPaymentPayload(price, total);
                            paymentIntentPromise = fetch(CONFIG.webhook, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }).then(r => r.json());
                        }
                        data = await paymentIntentPromise;
                    }

                    if (data && data.clientSecret) {
                        state.clientSecret = data.clientSecret;
                        state.orderId = data.Order_id || data.order_id;

                        elements = stripe.elements({
                            clientSecret: data.clientSecret,
                            appearance: {
                                theme: 'stripe',
                                variables: {
                                    fontFamily: 'Inter, system-ui, sans-serif',
                                    fontSizeBase: '16px',
                                    colorPrimary: '#007aff',
                                    colorText: '#1d1d1f',
                                    borderRadius: '12px',
                                    colorDanger: '#ff3b30'
                                }
                            }
                        });

                        cardElement = elements.create('card', {
                            hidePostalCode: true,
                            style: {
                                base: {
                                    fontSize: '16px',
                                    color: '#1d1d1f',
                                    '::placeholder': { color: '#86868b' },
                                    iconColor: '#007aff'
                                }
                            }
                        });
                        cardElement.mount('#card-element');

                        // Wait slightly for mount to settle and keep loader for vibes
                        setTimeout(() => {
                            loader.style.opacity = '0';
                            setTimeout(() => { loader.classList.remove('visible'); }, 300);
                        }, 1000);

                        // Payment Request check...
                        console.log("Initializing Payment Request with total:", total);
                        const pr = stripe.paymentRequest({
                            country: 'CZ', currency: 'czk',
                            total: { label: CONFIG.name, amount: Math.round(total * 100) },
                            requestPayerName: true, requestPayerEmail: true
                        });

                        // LISTENER FOR APPLE/GOOGLE PAY EVENTS
                        pr.on('paymentmethod', async (ev) => {
                            const { paymentIntent, error: confirmError } = await stripe.confirmCardPayment(
                                state.clientSecret,
                                { payment_method: ev.paymentMethod.id },
                                { handleActions: false }
                            );

                            if (confirmError) {
                                ev.complete('fail');
                                const msg = document.getElementById('payment-message');
                                msg.innerText = confirmError.message || "Ошибка оплаты";
                                msg.style.display = 'block';
                            } else {
                                ev.complete('success');
                                if (paymentIntent.status === "requires_action") {
                                    saveStateToStorage();
                                    const { error } = await stripe.confirmCardPayment(state.clientSecret, {
                                        return_url: window.location.href
                                    });
                                    if (error) {
                                        const msg = document.getElementById('payment-message');
                                        msg.innerText = error.message;
                                        msg.style.display = 'block';
                                    } else {
                                        document.getElementById('success-email').innerText = state.contact.email;
                                        goToStep(4);
                                    }
                                } else {
                                    document.getElementById('success-email').innerText = state.contact.email;
                                    goToStep(4);
                                }
                            }
                        });

                        pr.canMakePayment().then(result => {
                            console.log("Apple/Google Pay Availability:", result);
                            if (result) {
                                const wContainer = document.getElementById('wallet-container');
                                if (wContainer) {
                                    wContainer.style.display = 'block';
                                    wContainer.style.visibility = 'visible'; // Force visibility
                                    wContainer.style.opacity = '1';
                                }

                                prButton = elements.create('paymentRequestButton', {
                                    paymentRequest: pr,
                                    style: {
                                        paymentRequestButton: {
                                            theme: 'dark', // or 'dark-outline'
                                            height: '48px',
                                            type: 'buy'
                                        }
                                    }
                                });
                                prButton.mount('#wallet-element');
                            } else {
                                console.log("Apple/Google Pay not available");
                                const wContainer = document.getElementById('wallet-container');
                                if (wContainer) wContainer.style.display = 'none';
                                const wEl = document.getElementById('wallet-element');
                                if (wEl) wEl.style.display = 'none';
                            }
                        });

                    } else {
                        console.error('No clientSecret received from webhook');
                        alert('Error: Could not initialize payment (No Secret).');
                        loader.classList.remove('visible');
                    }
                } catch (e) {
                    console.error("Init Payment Error:", e);
                    // ALERT FOR MOBILE DEBUGGING
                    alert("Pay Init Error: " + e.message);
                    loader.classList.remove('visible');
                }
            } else {
                // Already initialized (coming back from step 4 or similar, re-show loader briefly)
                setTimeout(() => {
                    loader.style.opacity = '0';
                    setTimeout(() => { loader.classList.remove('visible'); }, 300);
                }, 1000);
            }
        }

        function destroyStripe() {
            if (cardElement) { try { cardElement.destroy(); } catch (e) { } cardElement = null; }
            if (prButton) { try { prButton.destroy(); } catch (e) { } prButton = null; }
            if (elements) { elements = null; }

            const cardEl = document.getElementById('card-element');
            if (cardEl) cardEl.innerHTML = '';

            const walletEl = document.getElementById('wallet-element');
            if (walletEl) walletEl.innerHTML = '';

            const walletContainer = document.getElementById('wallet-container');
            if (walletContainer) walletContainer.style.display = 'none';

            state.clientSecret = null;
            if (typeof paymentIntentPromise !== 'undefined') paymentIntentPromise = null;
            console.log("Stripe destroyed & Cache cleared");
        }

        async function confirmPayment() {
            if (!state.clientSecret) {
                alert("Ошибка: Платёжная сессия не найдена. Попробуйте обновить страницу.");
                return;
            }

            const btn = document.getElementById('btn-next-action');
            const msg = document.getElementById('payment-message');
            msg.style.display = 'none';

            btn.disabled = true;
            btn.innerText = 'Обработка...';

            saveStateToStorage();

            const { error } = await stripe.confirmCardPayment(state.clientSecret, {
                payment_method: {
                    card: cardElement,
                    billing_details: {
                        name: state.contact.email,
                        email: state.contact.email,
                        phone: state.contact.phone
                    }
                },
                receipt_email: state.contact.email, // Explicitly set for Dashboard visibility
                return_url: window.location.href
            });

            if (error) {
                msg.innerText = error.message;
                msg.style.display = 'block';
                msg.classList.add('shake'); setTimeout(() => msg.classList.remove('shake'), 500);

                btn.disabled = false;
                const price = state.plan === 'full' ? CONFIG.price : CONFIG.deposit;
                const total = price * state.count;
                btn.innerText = `Оплатить ${total} Kč`;
            } else {
                // Success
                document.getElementById('success-email').innerText = state.contact.email;
                goToStep(4);
            }
        }

    </script>

</body>

</html>